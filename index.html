<!DOCTYPE html>
<!--
  ============================================================================
  B.L.I.N.K. — LED Wall Calculator
  © 2025 Gabriel Labrecque
  Fearless Wanderer Productions

  This software is licensed:
  - Commercial use, redistribution, or sale requires a commercial license from Gabriel Labrecque.

  All rights reserved. Unauthorized copying, modification, distribution, or use outside the terms of these licenses is prohibited.
  ============================================================================
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="B.L.I.N.K.">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="description" content="Professional LED wall calculator with customizable power, data, structure, cabling, and canvas layouts.">
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://blink-led.com">
  <meta property="og:title" content="B.L.I.N.K. - LED Wall Calculator">
  <meta property="og:description" content="Professional LED wall calculator with customizable power, data, structure, cabling, and canvas layouts.">
  <meta property="og:image" content="https://blink-led.com/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="B.L.I.N.K. - LED Wall Calculator">
  <meta name="twitter:description" content="Professional LED wall calculator with customizable power, data, structure, cabling, and canvas layouts.">
  <meta name="twitter:image" content="https://blink-led.com/og-image.png">
  <!-- Cache control - prevent aggressive caching -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>B.L.I.N.K. - LED Wall Calculator</title>
  <link rel="icon" href="icons/icon-192.png" type="image/png">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS Icons - Generated PNG via canvas for iOS compatibility -->
  <link rel="apple-touch-icon" id="appleTouchIcon" href="">
  <script>
    (function() {
      var canvas = document.createElement('canvas');
      canvas.width = 180;
      canvas.height = 180;
      var ctx = canvas.getContext('2d');
      // Dark background with rounded corners (drawn as full rect since iOS clips it)
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(0, 0, 180, 180);
      // Green "LED" text
      ctx.fillStyle = '#10b981';
      ctx.font = 'bold 52px Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('LED', 90, 95);
      // Set the icon
      var link = document.getElementById('appleTouchIcon');
      if (link) link.href = canvas.toDataURL('image/png');
    })();
  </script>

  <!-- Comic book style fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Welcome Page -->
<div id="welcomePage" class="welcome-page">
  <div class="welcome-content">

    <!-- Hero Section -->
    <div class="welcome-hero">
      <div class="welcome-logo-container">
        <h1 class="welcome-title">B.L.I.N.K.</h1>
      </div>
      <p class="welcome-subtitle">Build Layout Intelligence for Networked Kits</p>
      <p class="welcome-subtitle"><span class="welcome-paren">&ldquo;</span> LED Calculator <span class="welcome-paren">&rdquo;</span></p>
    </div>

    <!-- Mode Selection Cards -->
    <div class="welcome-modes">
      <button class="welcome-btn welcome-btn-simple" onclick="enterSimpleMode()">
        <span class="welcome-btn-title">Simple</span>
        <span class="welcome-btn-desc">Quick setup with essential tools</span>
        <ul class="welcome-btn-features">
          <li>Panel Selection</li>
          <li>Dimensions</li>
          <li>Power &amp; Data</li>
          <li>Specs &amp; Canvas</li>
          <li>All Exports</li>
        </ul>
      </button>
      <button class="welcome-btn welcome-btn-complex" onclick="enterComplexMode()">
        <span class="welcome-btn-title">Complex</span>
        <span class="welcome-btn-desc">Full suite with layouts, gear &amp; combined view</span>
        <ul class="welcome-btn-features">
          <li>Everything in Simple +</li>
          <li>5 Layout Views</li>
          <li>Cable Lists</li>
          <li>Structure Specs with Approximate Weights</li>
          <li>Combined Screen Views</li>
        </ul>
      </button>
        <button class="welcome-btn welcome-btn-raster" onclick="enterRasterMode()">
          <span class="welcome-btn-title">Raster</span>
          <span class="welcome-btn-desc">Canvas mapping for LED raster workflows</span>
          <ul class="welcome-btn-features">
            <li>Canvas Mapping</li>
            <li>Multi-Screen Table</li>
            <li>File Save/Load</li>
            <li>PNG/JPEG/Resolume Export</li>
          </ul>
        </button>
        <button class="welcome-btn welcome-btn-testpattern" onclick="enterTestPatternMode()">
          <span class="welcome-btn-title">Test Pattern</span>
          <span class="welcome-btn-desc">Generate professional test pattern images</span>
          <ul class="welcome-btn-features">
            <li>Multi-Display Grid Patterns</li>
            <li>SMPTE Color Bars</li>
            <li>Coordinate Labels &amp; Crosshairs</li>
            <li>High-Res PNG Export</li>
          </ul>
        </button>
    </div>

    <!-- Sign In / Install -->
    <div class="welcome-action-row">
      <button class="welcome-btn-signin" onclick="openAuthModal('signin')">
        <span class="material-symbols-outlined icon-18-mr">login</span>
        Sign In
      </button>
      <button class="welcome-btn-signin welcome-install-btn" id="installPwaBtnWelcome" style="display: none;" onclick="installPwa()">
        <span class="material-symbols-outlined icon-18-mr">download</span>
        Install App
      </button>
    </div>
    <p class="welcome-signin-desc">Sign in for device sync and community sharing</p>

    <!-- Feature Showcase (desktop only via CSS) -->
    <div class="welcome-features">
      <div class="welcome-feature-card">
        <span class="material-symbols-outlined welcome-feature-icon">dashboard</span>
        <span class="welcome-feature-title">Professional Layouts</span>
        <span class="welcome-feature-desc">Power, Data, Structure, Combined, and Cabling layout views</span>
      </div>
      <div class="welcome-feature-card">
        <span class="material-symbols-outlined welcome-feature-icon">devices</span>
        <span class="welcome-feature-title">Multi-Screen</span>
        <span class="welcome-feature-desc">Add multiple screens to visualize and compare specs</span>
      </div>
      <div class="welcome-feature-card">
        <span class="material-symbols-outlined welcome-feature-icon">view_carousel</span>
        <span class="welcome-feature-title">Multi-Canvas</span>
        <span class="welcome-feature-desc">Organize screens across multiple canvas views</span>
      </div>
      <div class="welcome-feature-card">
        <span class="material-symbols-outlined welcome-feature-icon">download</span>
        <span class="welcome-feature-title">Export Options</span>
        <span class="welcome-feature-desc">PDF with all specs, layouts &amp; gear list. Canvas to PNG, JPEG, Resolume</span>
      </div>
      <div class="welcome-feature-card">
        <span class="material-symbols-outlined welcome-feature-icon">group</span>
        <span class="welcome-feature-title">Community Library</span>
        <span class="welcome-feature-desc">Share and download custom panels &amp; processors</span>
      </div>
    </div>

    <!-- FAQ Section (desktop only via CSS) -->
    <div class="welcome-faq">
      <h3 class="welcome-faq-title">FAQ</h3>
      <div class="welcome-faq-item">
        <button class="welcome-faq-q" onclick="toggleWelcomeFaq(this)">
          <span>What is B.L.I.N.K.?</span>
          <span class="welcome-faq-arrow">&#9660;</span>
        </button>
        <div class="welcome-faq-a">B.L.I.N.K. is a professional LED wall calculator for planning LED video wall installations. It calculates power, data, structure, and generates exportable layouts for your crew.</div>
      </div>
      <div class="welcome-faq-item">
        <button class="welcome-faq-q" onclick="toggleWelcomeFaq(this)">
          <span>How is my data handled?</span>
          <span class="welcome-faq-arrow">&#9660;</span>
        </button>
        <div class="welcome-faq-a">All data stays on your device by default. Cloud sync is opt-in and requires signing in. We don't track usage or sell data. Custom items you share to the community are visible to other users.</div>
      </div>
      <div class="welcome-faq-item">
        <button class="welcome-faq-q" onclick="toggleWelcomeFaq(this)">
          <span>Can I use B.L.I.N.K. offline?</span>
          <span class="welcome-faq-arrow">&#9660;</span>
        </button>
        <div class="welcome-faq-a">Yes. B.L.I.N.K. is a PWA that works fully offline after the first load. Install it to your home screen for a native app experience &mdash; perfect for on-site work without wifi.</div>
      </div>
    </div>

    <!-- Footer -->
    <div class="welcome-footer">
      <div class="welcome-footer-links">
        <button class="welcome-footer-link" onclick="openHelpModal()">Help</button>
        <button class="welcome-footer-link" onclick="openTermsModal()">Terms of Use</button>
        <button class="welcome-footer-link" onclick="window.location.href='mailto:info@blink-led.com'">Contact</button>
      </div>
      <div class="welcome-footer-meta">
        <span id="welcomeVersionLine"></span>
        <span>&copy; 2025 Gabriel Labrecque &bull; Fearless Wanderer Productions</span>
      </div>
    </div>

  </div>
</div>

<!-- Test Pattern Generator Page -->
<div id="testPatternPage" class="tp-page" style="display: none;">
  <div class="tp-header">
    <h1 class="tp-header-title">Test Pattern Generator</h1>
    <div class="tp-toolbar">
      <button class="tp-toolbar-btn" id="tpUndoBtn" title="Undo" disabled>
        <span class="material-symbols-outlined">undo</span>
      </button>
      <button class="tp-toolbar-btn" id="tpToolbarResetBtn" title="Reset">
        <span class="material-symbols-outlined">refresh</span>
      </button>
      <button class="tp-toolbar-btn" id="tpRedoBtn" title="Redo" disabled>
        <span class="material-symbols-outlined">redo</span>
      </button>
      <button class="tp-toolbar-btn" id="tpQuickSaveBtn" title="Save Pattern">
        <span class="material-symbols-outlined">save</span>
      </button>
      <button class="tp-toolbar-btn" id="tpQuickLoadBtn" title="Load Pattern">
        <span class="material-symbols-outlined">folder</span>
      </button>
      <div class="tp-share-wrap">
        <button class="tp-toolbar-btn" id="tpQuickShareBtn" title="Quick Share">
          <span class="material-symbols-outlined">share</span>
        </button>
        <div class="tp-share-popup" id="tpSharePopup">
          <button class="tp-share-option" id="tpSharePng">Export PNG</button>
          <button class="tp-share-option" id="tpShareMp4">Export MP4</button>
        </div>
      </div>
      <div class="tp-toolbar-divider"></div>
      <div class="tp-liveout-wrap">
        <button class="tp-toolbar-btn tp-liveout-btn" id="tpLiveOutBtn" title="Live Out">
          <span class="material-symbols-outlined">cast</span>
        </button>
        <div class="tp-liveout-popup" id="tpLiveOutPopup">
          <button class="tp-share-option" id="tpLiveOutFull">Full Output</button>
          <button class="tp-share-option" id="tpLiveOutSplit">Split Outputs</button>
        </div>
      </div>
    </div>
    <div class="tp-header-actions">
      <button class="tp-home-btn" onclick="exitTestPatternMode()" title="Home">
        <span class="material-symbols-outlined">home</span>
      </button>
      <div class="tp-layers-wrap">
        <button class="tp-layers-btn" id="tpLayersBtn" title="Layers">
          <span class="material-symbols-outlined">layers</span>
        </button>
        <div class="tp-layers-panel" id="tpLayersPanel">
          <div class="tp-layers-title">Layers</div>
          <div class="tp-layers-list" id="tpLayersList"></div>
        </div>
      </div>
      <div class="tp-hamburger-wrap">
        <button class="tp-hamburger-btn" id="tpHamburgerBtn" title="Menu">
          <span class="material-symbols-outlined">menu</span>
        </button>
        <div class="tp-hamburger-menu" id="tpHamburgerMenu">
          <button class="tp-menu-item" id="tpExportPng" title="Export as PNG image">Export PNG</button>
          <button class="tp-menu-item" id="tpExportMp4" title="Export as MP4 video">
            <span class="tp-menu-label">Export MP4</span>
          </button>
          <div class="tp-menu-item tp-menu-fps">
            <span>Framerate</span>
            <select id="tpSweepFps" class="tp-select tp-menu-select">
              <option value="23.976">23.98</option>
              <option value="24">24</option>
              <option value="25">25</option>
              <option value="29.97">29.97</option>
              <option value="30">30</option>
              <option value="50">50</option>
              <option value="59.94">59.94</option>
              <option value="60" selected>60</option>
              <option value="120">120</option>
            </select>
          </div>
          <div class="tp-menu-divider"></div>
          <button class="tp-menu-item" id="tpSavePatternFile">Save Pattern</button>
          <button class="tp-menu-item" id="tpLoadPatternFile">Load Pattern</button>
          <div class="tp-menu-divider"></div>
          <button class="tp-menu-item tp-menu-reset" id="tpResetBtn" title="Reset to defaults">
            <span class="material-symbols-outlined">refresh</span>
            Reset
          </button>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="tpLoadPatternInput" class="tp-file-input-hidden" accept=".blinktp,.tp,.json">

  <div class="tp-canvas-wrapper">
    <canvas id="tpCanvas"></canvas>
  </div>

  <div class="tp-controls">
    <!-- Column 1: Setup -->
    <div class="tp-controls-col">
      <div class="tp-section-header">
        <span class="tp-section-title">Screen Options</span>
      </div>
      <div class="tp-control-group">
        <label class="tp-label">Image Name:</label>
        <input type="text" id="tpImageName" class="tp-input" placeholder="Name your testpattern">
      </div>

      <div class="tp-control-group">
        <label class="tp-label">Display size [px]:</label>
        <div class="tp-row">
          <div class="number-input-with-arrows tp-arrows">
            <input type="number" id="tpDisplayW" value="1920" min="1">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('tpDisplayW', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('tpDisplayW', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
          <span class="tp-x-label">x</span>
          <div class="number-input-with-arrows tp-arrows">
            <input type="number" id="tpDisplayH" value="1080" min="1">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('tpDisplayH', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('tpDisplayH', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
        </div>
      </div>

      <div class="tp-control-group">
        <label class="tp-label">Displays:</label>
        <div class="tp-row">
          <select id="tpDisplaysWide" class="tp-select">
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
          </select>
          <span class="tp-x-label">x</span>
          <select id="tpDisplaysHigh" class="tp-select">
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
          </select>
        </div>
      </div>

      <div class="tp-control-group">
        <label class="tp-label">Total size [px]:</label>
        <div class="tp-row">
          <div class="number-input-with-arrows tp-arrows">
            <input type="number" id="tpTotalW" value="1920" min="1">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('tpTotalW', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('tpTotalW', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
          <span class="tp-x-label">x</span>
          <div class="number-input-with-arrows tp-arrows">
            <input type="number" id="tpTotalH" value="1080" min="1">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('tpTotalH', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('tpTotalH', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
        </div>
      </div>

      <div class="tp-section-header">
        <span class="tp-section-title">Processor Lines</span>
        <input type="color" id="tpProcessorLineColor" class="tp-color-input" value="#ff0000">
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Proc.</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpProcessorLinesToggle">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <select id="tpProcessorCanvasSize" class="tp-select tp-select-narrow">
          <option value="4K_UHD" selected>4K UHD</option>
          <option value="4K_DCI">4K DCI</option>
          <option value="HD">HD</option>
          <option value="custom">Custom</option>
        </select>
      </div>

      <div id="tpProcessorCustomSize" class="tp-control-group" style="display: none;">
        <label class="tp-label">Canvas size [px]:</label>
        <div class="tp-row">
          <div class="number-input-with-arrows tp-arrows">
            <input type="number" id="tpProcessorCustomW" value="3840" min="1">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('tpProcessorCustomW', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('tpProcessorCustomW', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
          <span class="tp-x-label">x</span>
          <div class="number-input-with-arrows tp-arrows">
            <input type="number" id="tpProcessorCustomH" value="2160" min="1">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('tpProcessorCustomH', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('tpProcessorCustomH', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Column 2: Text Options -->
    <div class="tp-controls-col">
      <div class="tp-section-header">
        <span class="tp-section-title">Text Options</span>
        <input type="color" id="tpTextColor" class="tp-color-input" value="#ffffff">
      </div>

      <div class="tp-slider-row">
        <label class="tp-label">Text size: <span id="tpTextSizeVal">50%</span></label>
        <input type="range" id="tpTextSize" class="tp-range" min="0" max="100" value="50">
      </div>

      <div class="tp-toggles-row">
        <div class="tp-toggle-row">
          <span class="tp-label">Name</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpShowName" checked>
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <div class="tp-toggle-row">
          <span class="tp-label">Pixel size</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpShowPixelSize" checked>
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <div class="tp-toggle-row">
          <span class="tp-label">Ratio</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpShowAspectRatio" checked>
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <div class="tp-toggle-row">
          <span class="tp-label">Squares</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpShowSquareCount" checked>
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="tp-section-header">
        <span class="tp-section-title">Add On's</span>
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Circles</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpCircles" checked>
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <select id="tpCircleSpinMode" class="tp-select tp-select-narrow">
          <option value="static" selected>Static</option>
          <option value="center">Spin center</option>
          <option value="corners">Spin corners</option>
          <option value="all">Spin all</option>
        </select>
        <select id="tpCircleRevMode" class="tp-select tp-select-narrow">
          <option value="none" selected>No reverse</option>
          <option value="center">Rev. center</option>
          <option value="corners">Rev. corners</option>
          <option value="all">Rev. all</option>
        </select>
      </div>

      <div id="tpSpinControls" class="tp-slider-row">
        <label class="tp-label">Spin speed: <span id="tpCircleSpinSpeedVal">50%</span></label>
        <input type="range" id="tpCircleSpinSpeed" class="tp-range" min="1" max="100" value="50">
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Color bars</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpColorBars" checked>
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <select id="tpColorBarsMode" class="tp-select tp-select-narrow">
          <option value="default" selected>Default</option>
          <option value="center">Center circle</option>
          <option value="corners">Corner circles</option>
          <option value="all">All circles</option>
          <option value="corners-center">Corners + center</option>
        </select>
      </div>

      <div class="tp-slider-row">
        <label class="tp-label">Bars opacity: <span id="tpColorBarsOpacityVal">100%</span></label>
        <input type="range" id="tpColorBarsOpacity" class="tp-range" min="0" max="100" value="100">
      </div>

    </div>

    <!-- Column 3: Grid & Checker Options -->
    <div class="tp-controls-col">
      <div class="tp-section-header">
        <span class="tp-section-title">Grid Options</span>
      </div>

      <div class="tp-colors-row">
        <div class="tp-control-group">
          <label class="tp-label">Grid</label>
          <input type="color" id="tpGridColor" class="tp-color-input" value="#d23de6">
        </div>
        <div class="tp-control-group">
          <label class="tp-label">Cross</label>
          <input type="color" id="tpCrossColor" class="tp-color-input" value="#00ff7b">
        </div>
        <div class="tp-control-group">
          <label class="tp-label">Displays</label>
          <input type="color" id="tpBoundaryColor" class="tp-color-input" value="#249be5">
        </div>
        <div class="tp-control-group">
          <label class="tp-label">BG</label>
          <input type="color" id="tpBgColor" class="tp-color-input" value="#000000">
        </div>
      </div>

      <div class="tp-slider-row">
        <label class="tp-label">Grid size: <span id="tpGridSizeVal">50%</span></label>
        <input type="range" id="tpGridSize" class="tp-range" min="0" max="100" value="50">
      </div>

      <div class="tp-slider-row">
        <label class="tp-label">Grid line width: <span id="tpGridWidthVal">50%</span></label>
        <input type="range" id="tpGridWidth" class="tp-range" min="0" max="100" value="50">
      </div>

      <div class="tp-section-header">
        <span class="tp-section-title">Checker Options</span>
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Checkered</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpChecker">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <div class="tp-inline-color-group">
          <span class="tp-inline-label">Color 1</span>
          <input type="color" id="tpCheckerColor1" class="tp-color-input" value="#000000">
        </div>
        <div class="tp-inline-color-group">
          <span class="tp-inline-label">Color 2</span>
          <input type="color" id="tpCheckerColor2" class="tp-color-input" value="#1a1a1a">
        </div>
      </div>

      <div class="tp-logo-controls" id="tpCheckerControls">
        <div class="tp-slider-row">
          <label class="tp-label">Checker size: <span id="tpCheckerSizeVal">50%</span></label>
          <input type="range" id="tpCheckerSize" class="tp-range" min="0" max="100" value="50">
        </div>
        <div class="tp-slider-row">
          <label class="tp-label">Checker opacity: <span id="tpCheckerOpacityVal">100%</span></label>
          <input type="range" id="tpCheckerOpacity" class="tp-range" min="0" max="100" value="100">
        </div>
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Border</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpCheckerBorder">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <div class="tp-inline-color-group">
          <span class="tp-inline-label">Color 1</span>
          <input type="color" id="tpBorderColor1" class="tp-color-input" value="#ffffff">
        </div>
        <div class="tp-inline-color-group">
          <span class="tp-inline-label">Color 2</span>
          <input type="color" id="tpBorderColor2" class="tp-color-input" value="#000000">
        </div>
      </div>

      <div class="tp-logo-controls" id="tpBorderControls">
        <div class="tp-slider-row">
          <label class="tp-label">Border size: <span id="tpBorderSizeVal">50%</span></label>
          <input type="range" id="tpBorderSize" class="tp-range" min="0" max="100" value="50">
        </div>
        <div class="tp-slider-row">
          <label class="tp-label">Border opacity: <span id="tpBorderOpacityVal">100%</span></label>
          <input type="range" id="tpBorderOpacity" class="tp-range" min="0" max="100" value="100">
        </div>
      </div>
    </div>

    <!-- Column 4: Sweep Options -->
    <div class="tp-controls-col tp-sweep-col">
      <div class="tp-section-header">
        <span class="tp-section-title">Sweep Options</span>
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Sweep</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpSweep">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <input type="color" id="tpSweepColor" class="tp-color-input" value="#ffffff" title="Horizontal band">
        <input type="color" id="tpSweepColorV" class="tp-color-input" value="#ffffff" title="Vertical band">
      </div>

      <div id="tpSweepControls" class="flex-col-gap-8">
        <div class="tp-slider-row">
          <label class="tp-label">Speed: <span id="tpSweepDurationVal">5s</span></label>
          <input type="range" id="tpSweepDuration" class="tp-range" min="1" max="10" value="5">
        </div>

        <div class="tp-slider-row">
          <label class="tp-label">Width: <span id="tpSweepWidthVal">2%</span></label>
          <input type="range" id="tpSweepWidth" class="tp-range" min="0.2" max="10" value="2" step="0.1">
        </div>
      </div>

      <div class="tp-section-header">
        <span class="tp-section-title">Logo Options</span>
      </div>

      <div class="tp-logo-header">
        <div class="tp-toggle-row">
          <span class="tp-label">Logo</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpLogoToggle">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <button class="tp-choose-file-btn" onclick="document.getElementById('tpLogoFile').click()">Choose File</button>
        <input type="file" id="tpLogoFile" class="tp-file-input-hidden" accept="image/*">
      </div>

      <div class="tp-logo-controls" id="tpLogoControls">
        <div class="tp-sweep-header">
          <span class="tp-label">Position</span>
          <select id="tpLogoMode" class="tp-select tp-select-narrow">
            <option value="default" selected>Default</option>
            <option value="center">Center circle</option>
            <option value="corners">Corner circles</option>
            <option value="all">All circles</option>
          </select>
          <div class="tp-toggle-row">
            <span class="tp-label">Static</span>
            <label class="cp-mini-toggle">
              <input type="checkbox" id="tpLogoStatic">
              <span class="cp-mini-toggle-slider"></span>
            </label>
          </div>
        </div>
        <div class="tp-slider-row">
          <label class="tp-label" id="tpLogoSizeLabel">Logo size: <span id="tpLogoSizeVal">50%</span></label>
          <input type="range" id="tpLogoSize" class="tp-range" min="0" max="100" value="50">
        </div>
        <div class="tp-slider-row">
          <label class="tp-label">Logo opacity: <span id="tpLogoOpacityVal">100%</span></label>
          <input type="range" id="tpLogoOpacity" class="tp-range" min="0" max="100" value="100">
        </div>
      </div>

      <div class="tp-section-header">
        <span class="tp-section-title">BG Image</span>
      </div>

      <div class="tp-sweep-header">
        <div class="tp-toggle-row">
          <span class="tp-label">BG Image</span>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="tpBgImageToggle">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <button class="tp-choose-file-btn" onclick="document.getElementById('tpBgImageFile').click()">Choose File</button>
        <input type="file" id="tpBgImageFile" class="tp-file-input-hidden" accept="image/*">
      </div>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="modal-overlay">
  <div class="modal-dialog modal-560 modal-scrollable">
    <div class="modal-header">
      <h2 class="modal-title">How to Use B.L.I.N.K.</h2>
      <button class="modal-close" onclick="closeHelpModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="help-content">

        <!-- Top-level 3-tab navigation -->
        <div class="slider-toggle mb-12">
          <button type="button" class="slider-toggle-btn help-main-tab-btn active" data-maintab="calculator" onclick="switchHelpMainTab('calculator')">Calculator</button>
          <button type="button" class="slider-toggle-btn help-main-tab-btn" data-maintab="raster" onclick="switchHelpMainTab('raster')">Raster</button>
          <button type="button" class="slider-toggle-btn help-main-tab-btn" data-maintab="testpattern" onclick="switchHelpMainTab('testpattern')">Test Pattern</button>
        </div>

        <!-- ==================== CALCULATOR TAB ==================== -->
        <div id="helpCalcTab">

          <h3 class="help-section-title">Getting Started</h3>
          <ol class="help-list">
            <li>Choose a Mode &mdash; select Simple or Complex on the welcome page</li>
            <li>Select a Panel Type &mdash; choose your LED panel from the dropdown</li>
            <li>Enter Dimensions &mdash; input panels wide/high or target wall size</li>
            <li>Configure Power &mdash; set voltage, breaker, and phase settings</li>
            <li>Configure Data &mdash; select processor, frame rate, and bit depth</li>
            <li>Review Results &mdash; check the calculated specifications</li>
            <li>View Layouts &mdash; explore Power, Data, and Structure layouts (Complex mode)</li>
            <li>Export &mdash; generate a PDF report, share gear list, or save configuration</li>
          </ol>

          <h3 class="help-section-title">Mode Features</h3>
          <div class="slider-toggle mb-12">
            <button type="button" class="slider-toggle-btn help-tab-btn active" data-tab="simple" onclick="switchHelpTab('simple')">Simple</button>
            <button type="button" class="slider-toggle-btn help-tab-btn" data-tab="complex" onclick="switchHelpTab('complex')">Complex</button>
          </div>
          <div id="helpSimpleContent">
            <p class="help-text help-text-highlight">Streamlined interface with essential tools</p>
            <ul class="help-list">
              <li>Panel selection &mdash; full built-in + custom panel library</li>
              <li>Dimensions &mdash; panels or target size with aspect ratio lock</li>
              <li>Power calculations &mdash; voltage, breaker, phase, circuit distribution</li>
              <li>Data calculations &mdash; processor, frame rate, bit depth</li>
              <li>Condensed specs display</li>
              <li>Canvas view &mdash; multi-screen positioning</li>
              <li>All exports &mdash; PDF, PNG, email, Resolume XML, .blinkled</li>
              <li>Unit conversion &mdash; Imperial / Metric</li>
              <li>Multi-screen projects</li>
              <li>Custom panels &amp; processors</li>
            </ul>
            <p class="help-text help-text-muted">Tabs: Simple, Canvas</p>
          </div>
          <div id="helpComplexContent" style="display: none;">
            <p class="help-text help-text-highlight">Full suite &mdash; everything in Simple, plus:</p>
            <ul class="help-list">
              <li>Full detailed specifications display</li>
              <li>Combined multi-screen view with aggregated specs</li>
              <li>Dedicated cable tab with cabling calculations, diagram, and cable list</li>
              <li>Structure calculations &mdash; bumpers, pickup weights, ground support</li>
              <li>Data direction controls &mdash; Top&rarr;Bottom, Bottom&rarr;Top, etc.</li>
              <li>Data &amp; Processor redundancy options</li>
              <li>6 layout views &mdash; Standard, Power, Data, Structure, Combined, and Cable</li>
              <li>Bumper bar management &mdash; auto + manual positioning</li>
              <li>Ground stack, hanging, and floor configurations</li>
            </ul>
            <p class="help-text help-text-muted">Tabs: Complex | Combined, Cable, Canvas</p>
          </div>

          <h3 class="help-section-title">Screen Tabs</h3>
          <ul class="help-list">
            <li><strong>Multiple Screens</strong> &mdash; create and manage multiple LED walls in one project</li>
            <li><strong>Add Screen (+)</strong> &mdash; click the + button to add a new screen</li>
            <li><strong>Switch Screens</strong> &mdash; click on any screen tab to switch between screens</li>
            <li><strong>Edit Screen</strong> &mdash; click the pencil icon to rename and change screen colors</li>
            <li><strong>Delete Screen</strong> &mdash; click the X to remove a screen (cannot delete last screen)</li>
          </ul>

          <h3 class="help-section-title">Panel Type</h3>
          <p class="help-text">Built-in panels:</p>
          <ul class="help-list">
            <li>ROE Black Pearl BP2 V2</li>
            <li>ROE Carbon CB5 MKII (+ Half Panel)</li>
            <li>ROE MC7H</li>
            <li>ROE Black Onyx BO3</li>
            <li>ROE Black Marble BM4 (Matte)</li>
            <li>ROE DM2.6</li>
            <li>INFiLED AMT 8.3</li>
          </ul>
          <p class="help-text"><strong>CB5 MKII:</strong> Half Panel Row toggle adds a row of half-height panels at the bottom. Choose between Air Frame or Connecting Plates.</p>
          <p class="help-text"><strong>DM2.6:</strong> Automatically uses connecting plates (2-way and 4-way).</p>
          <p class="help-text"><strong>BM4 (Matte):</strong> Floor panel &mdash; no bumper support.</p>

          <h3 class="help-section-title">Custom Panels</h3>
          <div class="help-simple-only">
            <ol class="help-list">
              <li>Open the hamburger menu or select in panel select dropdown</li>
              <li>Tap &ldquo;Add Panel&rdquo;</li>
              <li>Fill in specs: brand, name, pixel pitch, width/height, depth, resolution, power max/avg, brightness</li>
              <li>Manage via Menu &rarr; Manage Items &rarr; Panels tab</li>
            </ol>
          </div>
          <div class="help-complex-only" style="display: none;">
            <ol class="help-list">
              <li>Open the hamburger menu or select in panel select dropdown</li>
              <li>Tap &ldquo;Add Panel&rdquo;</li>
              <li>Fill in specs: brand, name, pixel pitch, width/height, depth, resolution, power max/avg, brightness, max hanging/stacking, weight, bumper weights, built-in cabling, structure and gear options</li>
              <li>Manage via Menu &rarr; Manage Items &rarr; Panels tab</li>
            </ol>
          </div>

          <h3 class="help-section-title">Custom Processors</h3>
          <ol class="help-list">
            <li>Open the hamburger menu or select in processor dropdown menu</li>
            <li>Tap &ldquo;Add Processor&rdquo;</li>
            <li>Fill in specs: brand, name, port type (1G/10G), pixels per port, frame rate, bit depth, total pixels, output ports, direct connectivity, distribution box config</li>
            <li>Manage via Menu &rarr; Manage Items &rarr; Processors tab</li>
          </ol>

          <h3 class="help-section-title">Dimensions</h3>
          <ul class="help-list">
            <li><strong>Panels mode</strong> &mdash; enter number of panels wide and high</li>
            <li><strong>Size mode</strong> &mdash; enter desired wall width and height (auto-calculates panels)</li>
            <li><strong>Units</strong> &mdash; toggle between Imperial (ft/lbs) and Metric (m/kg)</li>
            <li><strong>Aspect Ratio Lock</strong> &mdash; None, 16:9, 4:3, or Custom ratio</li>
          </ul>

          <h3 class="help-section-title">Power</h3>
          <ul class="help-list">
            <li><strong>Voltage</strong> &mdash; default 208V, or set custom voltage</li>
            <li><strong>Breaker</strong> &mdash; default 20A, or set custom breaker</li>
            <li><strong>Phase</strong> &mdash; 1-phase or 3-phase</li>
            <li><strong>Power Basis</strong> &mdash; Max (recommended) or Average</li>
            <li><strong>Max/Circuit</strong> &mdash; override max panels per circuit (leave blank for auto)</li>
          </ul>

          <h3 class="help-section-title">Data</h3>
          <p class="help-text">Processors: Brompton SX40, S8, M2, S4, T1, SQ200 &bull; NovaStar MX40 Pro &bull; Custom</p>
          <div class="help-simple-only">
            <ul class="help-list">
              <li><strong>Frame Rate</strong> &mdash; 24, 25, 30, 50, 60 Hz</li>
              <li><strong>Bit Depth</strong> &mdash; 8, 10, 12-bit</li>
              <li><strong>Max/Data</strong> &mdash; override max panels per data line (leave blank for auto)</li>
            </ul>
          </div>
          <div class="help-complex-only" style="display: none;">
            <ul class="help-list">
              <li><strong>Frame Rate</strong> &mdash; 24, 25, 30, 50, 60 Hz</li>
              <li><strong>Bit Depth</strong> &mdash; 8, 10, 12-bit</li>
              <li><strong>Max/Data</strong> &mdash; override max panels per data line (leave blank for auto)</li>
              <li><strong>Data Direction</strong> &mdash; Top&rarr;Bottom, Bottom&rarr;Top, All from Top, All from Bottom</li>
              <li><strong>Arrows</strong> &mdash; show/hide data routing arrows</li>
              <li><strong>Flip</strong> &mdash; flip direction of arrows</li>
              <li><strong>Data Redundancy</strong> &mdash; doubles ports needed</li>
              <li><strong>Processor Redundancy</strong> &mdash; doubles processor count</li>
            </ul>
          </div>
          <p class="help-text"><strong>MX40 Pro Direct:</strong> 20 outputs directly (10 with redundancy). <strong>Indirect:</strong> CVT-10 Pro boxes, 10 outputs each (5 with redundancy), up to 4 CVT boxes per processor.</p>

          <div class="help-complex-section" style="display: none;">
            <h3 class="help-section-title">Structure</h3>
            <ul class="help-list">
              <li><strong>Hanging</strong> &mdash; wall is flown/rigged from above</li>
              <li><strong>Ground Stack</strong> &mdash; wall on ground with base plates, outriggers, bracing</li>
              <li><strong>Floor</strong> &mdash; floor panel configuration</li>
              <li><strong>Bumpers</strong> &mdash; toggle on/off, 4-way option (CB5 only)</li>
              <li><strong>Auto mode</strong> &mdash; bumpers auto-distribute across wall width</li>
              <li><strong>Manual mode</strong> &mdash; drag bumpers to reposition, delete bumpers, or swap between 1w or 2w bumpers</li>
              <li><strong>Desktop:</strong> right-click bumpers for options</li>
              <li><strong>Mobile:</strong> tap to select, tap again for options, hold and drag to move</li>
            </ul>
          </div>

          <div class="help-complex-section" style="display: none;">
            <h3 class="help-section-title">Layout Views</h3>
            <p class="help-text">In Complex mode, toggle between layouts below the specs:</p>
            <ul class="help-list">
              <li><strong>Standard</strong> &mdash; panel grid with checkerboard coloring, click to delete/restore panels, assign custom circuits or data lines</li>
              <li><strong>Power</strong> &mdash; color-coded circuit distribution with circuit numbers</li>
              <li><strong>Data</strong> &mdash; data routing paths with line numbers and direction arrows</li>
              <li><strong>Structure</strong> &mdash; bumper positions, pickup weights, and ground support hardware</li>
            </ul>
            <p class="help-text">Tap a layout section title to collapse/expand it.</p>
          </div>

          <div class="help-complex-section" style="display: none;">
            <h3 class="help-section-title">Combined View</h3>
            <p class="help-text">View multiple screens together in a unified interface.</p>
            <ul class="help-list">
              <li>Select which screens to include</li>
              <li><strong>Zoom</strong> &mdash; 50%&ndash;200% to see detail or overview</li>
              <li><strong>Manual Adjust</strong> &mdash; drag screens to custom positions</li>
              <li>Click panels to select across screens; Ctrl+click for multi-select</li>
              <li>Right-click selected panels for circuit/data assignment</li>
              <li>Combined specs across all selected screens</li>
              <li>Combined Power, Data, Structure, and Cable layout views</li>
              <li>Combined Cable list</li>
            </ul>
          </div>

          <div class="help-complex-section" style="display: none;">
            <h3 class="help-section-title">Cable Tab</h3>
            <p class="help-text">Cabling calculations and cable layout diagram.</p>
            <ul class="help-list">
              <li>Switch to the <strong>Cable</strong> tab in the bottom nav</li>
              <li><strong>General</strong> &mdash; Wall to Floor distance, Cable Pick height, Cable Drop position (Behind, SR, SL)</li>
              <li><strong>Power</strong> &mdash; Distro to Drop distance, Power In position (Top, Bottom)</li>
              <li><strong>Data</strong> &mdash; Proc to Drop, Server to Proc distances, Dist Box on-wall toggle with position controls</li>
              <li><strong>Cable Diagram</strong> &mdash; front-view layout showing cable routing from wall to processor/distro</li>
              <li><strong>Cable List</strong> &mdash; equipment and cable counts organized by category</li>
            </ul>
          </div>

          <h3 class="help-section-title">Canvas View</h3>
          <p class="help-text">Position multiple screens visually on a virtual canvas.</p>
          <ul class="help-list">
            <li><strong>Canvas Size</strong> &mdash; 4K UHD, 4K DCI, HD, or Custom dimensions</li>
            <li><strong>Drag screens</strong> &mdash; tap and drag to reposition on canvas</li>
            <li><strong>X/Y Pos</strong> &mdash; set exact pixel positions</li>
            <li><strong>Fine (px)</strong> &mdash; set arrow key increment for precise adjustments</li>
            <li><strong>Snap</strong> &mdash; toggle snapping to other screens and canvas edges</li>
            <li><strong>Zoom</strong> &mdash; +/- buttons, type a %, or Ctrl+Scroll (desktop)</li>
            <li><strong>Pan</strong> &mdash; drag empty space when zoomed in</li>
            <li><strong>Screen toggles</strong> &mdash; show/hide individual screens, XY pos, pixel dimensions, X crosshair</li>
            <li><strong>Export</strong> &mdash; PNG, JPEG, or Resolume XML with custom filename</li>
            <li><strong>Resolume file</strong> &mdash; import in Resolume&rsquo;s advanced output section to create input and output screens based on canvas positions</li>
            <li><strong>Add Canvas</strong> &mdash; add more than one canvas if your screens don&rsquo;t all fit on one canvas</li>
          </ul>

          <h3 class="help-section-title">Exports</h3>
          <div class="help-simple-only">
            <ul class="help-list">
              <li><strong>PDF</strong> &mdash; report with basic specs</li>
              <li><strong>PNG/JPEG</strong> &mdash; canvas view at full resolution</li>
              <li><strong>Email Gear List</strong> &mdash; formatted breakdown by screen</li>
              <li><strong>Resolume XML</strong> &mdash; Arena 7 compatible LED mapping</li>
              <li><strong>Save/Load</strong> &mdash; .blinkled, .blinkrast, .blinktp files with full project state</li>
            </ul>
          </div>
          <div class="help-complex-only" style="display: none;">
            <ul class="help-list">
              <li><strong>PDF</strong> &mdash; multi-page report with specs, layouts, gear list per screen. Toggles to select what is exported. Print-friendly options</li>
              <li><strong>PNG/JPEG</strong> &mdash; canvas view at full resolution</li>
              <li><strong>Email Gear List</strong> &mdash; formatted breakdown by screen</li>
              <li><strong>Resolume XML</strong> &mdash; Arena 7 compatible LED mapping</li>
              <li><strong>Save/Load</strong> &mdash; .blinkled, .blinkrast, .blinktp files with full project state</li>
            </ul>
          </div>
          <p class="help-text">On mobile, exports use the native share sheet.</p>

          <h3 class="help-section-title">Mobile (Touch)</h3>
          <ul class="help-list">
            <li><strong>Tap</strong> &mdash; select panels, buttons, controls</li>
            <li><strong>Layout views</strong> &mdash; tap once to select panels, tap again to open options</li>
            <li><strong>Drag</strong> &mdash; move screens in canvas view</li>
            <li><strong>Pinch zoom</strong> &mdash; zoom in/out on canvas</li>
            <li><strong>Hamburger menu</strong> &mdash; access all options</li>
          </ul>

          <h3 class="help-section-title">Desktop (Mouse)</h3>
          <ul class="help-list">
            <li><strong>Click / Drag</strong> &mdash; select and move panels</li>
            <li><strong>Right-click</strong> &mdash; context menus for bumpers and panels</li>
            <li><strong>Ctrl+Scroll</strong> &mdash; zoom canvas</li>
          </ul>

          <h3 class="help-section-title">Keyboard Shortcuts</h3>
          <table class="help-table">
            <tr><td>Ctrl+Z</td><td>Undo (panels, bumpers, canvas moves)</td></tr>
            <tr><td>Ctrl+Y</td><td>Redo</td></tr>
            <tr><td>Arrow Keys</td><td>Fine position adjustment in Canvas</td></tr>
            <tr><td>Ctrl+Scroll</td><td>Zoom in/out in Canvas</td></tr>
            <tr><td>Delete</td><td>Remove selected panels</td></tr>
          </table>

          <h3 class="help-section-title">Preset Panels</h3>
          <table class="help-table">
            <tr><td>BP2 V2</td><td>2.84mm &bull; 500&times;500mm &bull; 176&times;176px</td></tr>
            <tr><td>CB5 MKII</td><td>5.77mm &bull; 600&times;1200mm &bull; 104&times;208px</td></tr>
            <tr><td>CB5 Half</td><td>5.77mm &bull; 600&times;600mm &bull; 104&times;104px</td></tr>
            <tr><td>MC7H</td><td>7.5mm &bull; 600&times;600mm &bull; 80&times;80px</td></tr>
            <tr><td>BO3</td><td>3.47mm &bull; 500&times;500mm &bull; 144&times;144px</td></tr>
            <tr><td>BM4 Matte</td><td>4.76mm &bull; 610&times;610mm &bull; 128&times;128px</td></tr>
            <tr><td>DM2.6</td><td>2.6mm &bull; 500&times;500mm &bull; 192&times;192px</td></tr>
            <tr><td>AMT 8.3</td><td>8.33mm &bull; 1000&times;1000mm &bull; 120&times;120px</td></tr>
          </table>

          <h3 class="help-section-title">Preset Processors</h3>
          <table class="help-table">
            <tr><td>SX40</td><td>40 &times; 1G &bull; XD Box (10 ports)</td></tr>
            <tr><td>S8</td><td>8 &times; 1G &bull; Direct</td></tr>
            <tr><td>M2</td><td>2 &times; 1G &bull; Direct</td></tr>
            <tr><td>S4</td><td>4 &times; 1G &bull; Direct</td></tr>
            <tr><td>T1</td><td>1 &times; 1G &bull; Direct</td></tr>
            <tr><td>SQ200</td><td>4 &times; 1G &bull; Direct</td></tr>
            <tr><td>MX40 Pro</td><td>40 &times; 1G &bull; CVT Box (10 ports)</td></tr>
          </table>

          <h3 class="help-section-title">Sign In &amp; Cloud Sync</h3>
          <p class="help-text">Sign in to sync custom panels, processors, and recent projects across devices.</p>
          <ul class="help-list">
            <li><strong>Sign In</strong> &mdash; tap &ldquo;Sign In&rdquo; on the welcome page</li>
            <li><strong>Create Account</strong> &mdash; switch to the &ldquo;Create Account&rdquo; tab to register</li>
            <li><strong>Device Sync</strong> &mdash; custom items and recent projects sync automatically</li>
            <li><strong>Password Reset</strong> &mdash; reset via email link</li>
            <li><strong>Sign Out</strong> &mdash; welcome page shows &ldquo;Sign Out&rdquo; when logged in</li>
          </ul>

          <h3 class="help-section-title">Community Sharing</h3>
          <p class="help-text">Share your custom panels and processors with the community.</p>
          <ul class="help-list">
            <li><strong>Share</strong> &mdash; edit a custom item and tap the purple Share button</li>
            <li><strong>Browse</strong> &mdash; Menu &rarr; Manage Items &rarr; Community tab</li>
            <li><strong>Download</strong> &mdash; tap &ldquo;Add&rdquo; to add community items to your library</li>
            <li><strong>&#9733; Indicator</strong> &mdash; community items show a star in the dropdown</li>
          </ul>

          <h3 class="help-section-title">Requests</h3>
          <p class="help-text">Want a panel, processor, or any related item added to the app library?</p>
          <ul class="help-list">
            <li>Open hamburger menu &rarr; Requests</li>
            <li>Fill in brand, model name, and any additional info (spec sheet links, etc.)</li>
            <li>Tap &ldquo;Send Request&rdquo; &mdash; opens your email app with a pre-filled message</li>
          </ul>

          <h3 class="help-section-title">Tips &amp; Best Practices</h3>
          <div class="help-simple-only">
            <ul class="help-list">
              <li>Select your panel first &mdash; it affects all calculations</li>
              <li>Verify circuit counts match your available power</li>
              <li>Save configurations frequently using the Save button</li>
              <li>Use multiple screens to organize complex setups</li>
              <li>Add custom panels for any LED product not in the library</li>
              <li>Sign in for device sync and community sharing</li>
              <li>Export a PDF for documentation and sharing</li>
            </ul>
          </div>
          <div class="help-complex-only" style="display: none;">
            <ul class="help-list">
              <li>Select your panel first &mdash; it affects all calculations</li>
              <li>Data Redundancy is enabled by default for professional installs</li>
              <li>Verify circuit counts match your available power</li>
              <li>Review structure layout &mdash; confirm pickup weights are within rigging limits</li>
              <li>Save configurations frequently using the Save button</li>
              <li>Use multiple screens to organize complex setups</li>
              <li>Add custom panels for any LED product not in the library</li>
              <li>Sign in for device sync and community sharing</li>
              <li>Export a PDF for documentation and sharing</li>
            </ul>
          </div>
        </div>

        <!-- ==================== RASTER TAB ==================== -->
        <div id="helpRasterTab" style="display: none;">
          <h3 class="help-section-title">Raster</h3>
          <p class="help-text">Canvas mapping for LED raster workflows. Access from the &ldquo;Raster&rdquo; button on the welcome page.</p>
          <ul class="help-list">
            <li><strong>Screen Table</strong> &mdash; spreadsheet-style table to manage screens: name, panel type, tile resolution, columns, rows, offset X/Y</li>
            <li><strong>Overlays</strong> &mdash; toggle per-screen X/Y coordinates, pixel dimensions, and crosshair</li>
            <li><strong>Active Toggle</strong> &mdash; show/hide individual screens on the canvas</li>
            <li><strong>Duplicate Button</strong> &mdash; duplicate screen</li>
            <li><strong>+ Add Screen</strong> &mdash; add new screens with built-in or custom panels</li>
            <li><strong>Canvas</strong> &mdash; works the same as the calculator canvas</li>
            <li><strong>Toolbar</strong> &mdash; filename, save/load .blinkrast files, canvas size presets, X/Y position, fine increment, snap, export format (PNG, JPEG, Resolume)</li>
          </ul>
        </div>

        <!-- ==================== TEST PATTERN TAB ==================== -->
        <div id="helpTestPatternTab" style="display: none;">
          <h3 class="help-section-title">Test Pattern Generator</h3>
          <p class="help-text">Generate professional test pattern images and videos for LED walls and displays.</p>
          <ul class="help-list">
            <li><strong>Access</strong> &mdash; tap &ldquo;Test Pattern&rdquo; on the welcome page</li>
            <li><strong>Screen Options</strong> &mdash; image name, display size, displays grid (up to 12&times;12), auto-calculated total size</li>
            <li><strong>Processor Lines</strong> &mdash; show where processor canvas boundaries fall (4K UHD, 4K DCI, HD, or custom size)</li>
            <li><strong>Background</strong> &mdash; BG color, checker pattern with size/opacity/colors, checker border, and BG image upload</li>
            <li><strong>Sliders</strong> &mdash; grid size, grid line width, text size</li>
            <li><strong>Colors</strong> &mdash; grid, text, crosshair, display boundary, background, and processor line</li>
            <li><strong>Circles</strong> &mdash; alignment circles with spin mode (static/CW/CCW), revolution mode, and speed</li>
            <li><strong>Color Bars</strong> &mdash; calibration bars with mode (default/circle) and opacity</li>
            <li><strong>Logo</strong> &mdash; upload custom logo with size, opacity, placement mode, and static option</li>
            <li><strong>Sweep</strong> &mdash; animated H/V sweep lines for testing display sync, with duration and width controls</li>
            <li><strong>Layers</strong> &mdash; drag-and-drop panel to reorder all visual elements</li>
            <li><strong>Save/Load</strong> &mdash; save and load .blinktp pattern files from toolbar or hamburger menu</li>
            <li><strong>Live Out</strong> &mdash; popup window mirroring the canvas in real-time for display testing, with fullscreen (F key or double-click) and cursor auto-hide</li>
            <li><strong>Export</strong> &mdash; PNG at full resolution, or MP4 video for animated patterns (sweep, spinning circles)</li>
            <li><strong>Toolbar</strong> &mdash; undo/redo, save/load, share (PNG/MP4), reset</li>
          </ul>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Terms of Use Modal -->
<div id="termsModal" class="modal-overlay">
  <div class="modal-dialog modal-480 modal-scrollable">
    <div class="modal-header">
      <h2 class="modal-title">Terms of Use</h2>
      <button class="modal-close" onclick="closeTermsModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="help-content">
        <h3 class="help-section-title">Usage</h3>
        <ul class="help-list">
          <li>Calculations are estimates &mdash; always verify with manufacturer specs</li>
        </ul>
        <h3 class="help-section-title">Your Data</h3>
        <ul class="help-list">
          <li>All project data is stored locally on your device</li>
          <li>Cloud sync (sign-in) stores your custom panels/processors, syncs devices, and syncs projects across signed-in devices</li>
          <li>We do not track, sell, or share your data</li>
        </ul>
        <h3 class="help-section-title">Software License</h3>
        <p class="help-text">B.L.I.N.K. is proprietary software. You may use this app for personal and professional LED wall planning. You may not copy, redistribute, reverse-engineer, or create derivative works from the source code without written permission.</p>
        <h3 class="help-section-title">Community Content</h3>
        <p class="help-text">Custom panels and processors you create are yours. When you share items to the community library, you grant permission for other users to download and use them within the app.</p>
        <h3 class="help-section-title">Ownership</h3>
        <p class="help-text">&copy; 2025 Gabriel Labrecque. All rights reserved. The software, code, design, and content are the intellectual property of Gabriel Labrecque / Fearless Wanderer Productions.</p>
        <h3 class="help-section-title">Disclaimer</h3>
        <p class="help-text">This software provides decision-support and planning estimates for LED system design. All results must be verified and approved by qualified professionals before real-world use. The user assumes full responsibility for final design, safety compliance, and implementation. No warranty is provided, and the developer assumes no liability for resulting damages or losses. Use of this software is at your own risk.</p>
        <h3 class="help-section-title">Contact</h3>
        <p class="help-text"><a href="mailto:info@blink-led.com" class="link-inherit">info@blink-led.com</a></p>
      </div>
    </div>
  </div>
</div>

<!-- Recent Projects Modal -->
<div id="recentProjectsModal" class="modal-overlay">
  <div class="modal-dialog modal-480 modal-scrollable">
    <div class="modal-header">
      <h2 class="modal-title">Recent Projects</h2>
      <button class="modal-close" onclick="closeRecentProjectsModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div id="recentProjectsList"></div>
    </div>
  </div>
</div>

<!-- Custom Panel Modal -->
<div id="customPanelModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title" id="customPanelModalTitle">Add Custom Panel</h2>
      <button class="modal-close" onclick="closeCustomPanelModal()">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Tab Navigation -->
      <div class="slider-toggle mb-12">
        <button type="button" class="slider-toggle-btn active" id="cpTabSpecsBtn" onclick="switchCustomPanelTab('specs')">Specs</button>
        <button type="button" class="slider-toggle-btn" id="cpTabCablesBtn" onclick="switchCustomPanelTab('cables')">Cables</button>
        <button type="button" class="slider-toggle-btn" id="cpTabStructureBtn" onclick="switchCustomPanelTab('structure')">Structure</button>
        <button type="button" class="slider-toggle-btn" id="cpTabGearBtn" onclick="switchCustomPanelTab('gear')">Gear</button>
      </div>

      <!-- Tab 1: Specs (all existing fields) -->
      <div id="cpTabSpecs" class="cp-tab-content">
        <div class="modal-input-group">
          <label>Panel Brand</label>
          <input type="text" id="customPanelBrand" placeholder="e.g., ROE Visual">
        </div>

        <div class="modal-input-group">
          <label>Panel Name</label>
          <input type="text" id="customPanelName" placeholder="e.g., Black Pearl BP2">
        </div>

        <div class="modal-input-group">
          <label id="labelPixelPitch">Pixel Pitch (mm)</label>
          <input type="number" id="customPanelPixelPitch" step="0.01" placeholder="e.g., 2.84">
        </div>

        <div class="modal-input-row">
          <div class="modal-input-group">
            <label id="labelPanelWidth">Panel Width (mm)</label>
            <input type="number" id="customPanelWidth" step="0.1" placeholder="e.g., 500">
          </div>
          <div class="modal-input-group">
            <label id="labelPanelHeight">Panel Height (mm)</label>
            <input type="number" id="customPanelHeight" step="0.1" placeholder="e.g., 500">
          </div>
        </div>

        <div class="modal-input-group">
          <label id="labelPanelDepth">Panel Depth (mm)</label>
          <input type="number" id="customPanelDepth" step="0.1" placeholder="e.g., 90">
        </div>

        <div class="modal-input-row">
          <div class="modal-input-group">
            <label>Resolution Width (px)</label>
            <input type="number" id="customPanelResX" placeholder="e.g., 176">
          </div>
          <div class="modal-input-group">
            <label>Resolution Height (px)</label>
            <input type="number" id="customPanelResY" placeholder="e.g., 176">
          </div>
        </div>

        <div class="modal-input-row">
          <div class="modal-input-group">
            <label>Max Power (W)</label>
            <input type="number" id="customPanelPowerMax" step="1" placeholder="e.g., 250">
          </div>
          <div class="modal-input-group">
            <label>Avg Power (W)</label>
            <input type="number" id="customPanelPowerAvg" step="1" placeholder="e.g., 125">
          </div>
        </div>

        <div class="modal-input-group">
          <label>Brightness (nits)</label>
          <input type="number" id="customPanelBrightness" placeholder="e.g., 5000">
        </div>

        <div class="modal-input-group">
          <label id="labelPanelWeight">Panel Weight (kg)</label>
          <input type="number" id="customPanelWeight" step="0.1" placeholder="e.g., 8.5">
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="customPanelRemovableFrame" onchange="updateFrameWeightFields()">
          <label for="customPanelRemovableFrame">Has Removable Frame</label>
        </div>

        <div id="frameWeightFields" style="display: none;">
          <div class="modal-input-row">
            <div class="modal-input-group">
              <label id="labelFrameWeight">Frame Weight (kg)</label>
              <input type="number" id="customPanelFrameWeight" step="0.1" placeholder="e.g., 1.2">
            </div>
            <div class="modal-input-group">
              <label id="labelWeightNoFrame">Weight Without Frame (kg)</label>
              <input type="number" id="customPanelWeightNoFrame" step="0.1" placeholder="e.g., 7.3">
            </div>
          </div>
        </div>

      </div>

      <!-- Tab 2: Cables -->
      <div id="cpTabCables" class="cp-tab-content" style="display: none;">
        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Built-in Jumpers</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpJumpersBuiltin" onchange="setCustomPanelJumperType(this.checked)">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>

        <div id="cpExternalJumperFields">
          <div class="modal-input-row">
            <div class="modal-input-group">
              <label>Data Jumper Length</label>
              <input type="text" id="customPanelDataJumper" placeholder="e.g., 1'">
            </div>
            <div class="modal-input-group">
              <label>Power Jumper Length</label>
              <input type="text" id="customPanelPowerJumper" placeholder="e.g., 1'">
            </div>
          </div>
        </div>

        <div class="modal-input-group">
          <label>Data Cross Jumper Length</label>
          <input type="text" id="customPanelCrossJumper" placeholder="e.g., 2'">
        </div>
      </div>

      <!-- Tab 3: Structure -->
      <div id="cpTabStructure" class="cp-tab-content" style="display: none;">
        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Hanging / Ground Stack</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpUsesBumpers" checked onchange="setCustomPanelBumpers(this.checked)">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>

        <div id="cpBumperWeightFields">
          <div class="modal-input-row mt-4">
            <div class="modal-input-group">
              <label>Max Panels Hanging</label>
              <input type="number" id="customPanelMaxHanging" placeholder="e.g., 20">
            </div>
            <div class="modal-input-group">
              <label>Max Panels Stacking</label>
              <input type="number" id="customPanelMaxStacking" placeholder="e.g., 12">
            </div>
          </div>
          <div class="modal-input-row">
            <div class="modal-input-group">
              <label id="label1wBumper">1W Bumper Weight (lbs)</label>
              <input type="number" id="customPanel1wBumper" step="0.1" placeholder="e.g., 5.5">
            </div>
            <div class="modal-input-group">
              <label id="label2wBumper">2W Bumper Weight (lbs)</label>
              <input type="number" id="customPanel2wBumper" step="0.1" placeholder="e.g., 8.8">
            </div>
          </div>
          <div class="modal-input-group">
            <label id="label4wBumper">4W Bumper Weight (lbs)</label>
            <input type="number" id="customPanel4wBumper" step="0.1" placeholder="e.g., 66.15">
          </div>
        </div>

        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Floor Panel</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpFloorPanel" onchange="setCustomPanelFloor(this.checked)">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>

        <div id="cpFloorFrameFields" style="display: none;">
          <div class="modal-input-row mt-10">
            <div class="modal-input-group">
              <label id="labelFrame1x1">1x1 Frame Weight (lbs)</label>
              <input type="number" id="customPanelFrame1x1" step="0.1" placeholder="e.g., 26.5">
            </div>
            <div class="modal-input-group">
              <label id="labelFrame2x1">2x1 Frame Weight (lbs)</label>
              <input type="number" id="customPanelFrame2x1" step="0.1" placeholder="e.g., 41.9">
            </div>
          </div>
          <div class="modal-input-row">
            <div class="modal-input-group">
              <label id="labelFrame2x2">2x2 Frame Weight (lbs)</label>
              <input type="number" id="customPanelFrame2x2" step="0.1" placeholder="e.g., 62.8">
            </div>
            <div class="modal-input-group">
              <label id="labelFrame3x2">3x2 Frame Weight (lbs)</label>
              <input type="number" id="customPanelFrame3x2" step="0.1" placeholder="e.g., 80.5">
            </div>
          </div>
          <div class="modal-input-row">
            <div class="modal-input-group">
              <label>Custom Frame Name</label>
              <input type="text" id="customPanelFrameName" placeholder="e.g., 4x3">
            </div>
            <div class="modal-input-group">
              <label>Panels in Frame</label>
              <input type="number" id="customPanelFramePanels" step="1" placeholder="e.g., 12">
            </div>
          </div>
          <div class="modal-input-group">
            <label id="labelFrameCustom">Custom Frame Weight (lbs)</label>
            <input type="number" id="customPanelFrameCustomWeight" step="0.1" placeholder="e.g., 95.0">
          </div>
        </div>
      </div>

      <!-- Tab 4: Gear (Complex mode only) -->
      <div id="cpTabGear" class="cp-tab-content" style="display: none;">
        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Needs Shackles & Cheeseyes</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpNeedsShackles" onchange="setCustomPanelShackleMode(this.checked)">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
        <div id="cpShackleFields" style="display: none;">
          <div class="cp-toggle-row">
            <label class="cp-toggle-label">Double Shackles per 2W Bumper</label>
            <label class="cp-mini-toggle">
              <input type="checkbox" id="cpDoubleShackles">
              <span class="cp-mini-toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Uses Connecting Plates</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpUsesConnectingPlates">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>

        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Supports 4W Bumpers</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpSupports4wBumpers">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>

        <div class="cp-toggle-row">
          <label class="cp-toggle-label">Needs Bridge Clamp Adapters</label>
          <label class="cp-mini-toggle">
            <input type="checkbox" id="cpNeedsBridgeAdapters">
            <span class="cp-mini-toggle-slider"></span>
          </label>
        </div>
      </div>

    </div>
    <div class="modal-footer modal-footer-gap">
      <button class="btn-secondary" onclick="closeCustomPanelModal()">Cancel</button>
      <button class="btn-secondary" id="sharePanelBtn" onclick="shareCustomPanelToCommunity()" style="display: none;">Share to Community</button>
      <button class="btn-primary" onclick="saveCustomPanel()">Save Panel</button>
    </div>
  </div>
</div>

<!-- Custom Processor Modal -->
<div id="customProcessorModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title" id="customProcessorModalTitle">Add Custom Processor</h2>
      <button class="modal-close" onclick="closeCustomProcessorModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-input-row">
        <div class="modal-input-group">
          <label>Brand</label>
          <input type="text" id="customProcessorBrand" placeholder="e.g., Brompton">
        </div>
        <div class="modal-input-group">
          <label>Name</label>
          <input type="text" id="customProcessorName" placeholder="e.g., SX40">
        </div>
      </div>

      <div class="modal-input-row">
        <div class="modal-input-group">
          <label>Port Type</label>
          <select id="customProcessorPortType" onchange="updateProcessorPortLabel()">
            <option value="1g">1G</option>
            <option value="10g">10G</option>
          </select>
        </div>
        <div class="modal-input-group">
          <label id="labelPixelsPerPort">Pixels per Port</label>
          <input type="number" id="customProcessorPixelsPerPort" placeholder="e.g., 525000">
        </div>
      </div>

      <div class="modal-input-row">
        <div class="modal-input-group">
          <label>Base Frame Rate</label>
          <input type="number" id="customProcessorFrameRate" placeholder="60" value="60">
        </div>
        <div class="modal-input-group">
          <label>Base Bit Depth</label>
          <input type="number" id="customProcessorBitDepth" placeholder="8" value="8">
        </div>
      </div>

      <div class="modal-input-row">
        <div class="modal-input-group">
          <label>Total Pixel Capacity</label>
          <input type="number" id="customProcessorTotalPixels" placeholder="e.g., 9000000">
        </div>
        <div class="modal-input-group">
          <label>Number of Output Ports</label>
          <input type="number" id="customProcessorOutputPorts" placeholder="e.g., 4">
        </div>
      </div>

      <div class="cp-toggle-row">
        <label class="cp-toggle-label">Direct Mode</label>
        <label class="cp-mini-toggle">
          <input type="checkbox" id="cpProcessorDirect" checked>
          <span class="cp-mini-toggle-slider"></span>
        </label>
      </div>
      <div class="cp-toggle-row">
        <label class="cp-toggle-label">Indirect Mode (Distribution Box)</label>
        <label class="cp-mini-toggle">
          <input type="checkbox" id="cpProcessorDistBox" onchange="setCustomProcessorDistBox(this.checked)">
          <span class="cp-mini-toggle-slider"></span>
        </label>
      </div>
      <div id="cpProcessorDistBoxFields" style="display: none;">
        <div class="modal-input-row">
          <div class="modal-input-group">
            <label>Distribution Box Name</label>
            <input type="text" id="customProcessorDistBoxName" placeholder="e.g., Brompton XD">
          </div>
          <div class="modal-input-group">
            <label>Ports per Box</label>
            <input type="number" id="customProcessorDistBoxPorts" placeholder="e.g., 10">
          </div>
        </div>
      </div>

      <div class="cp-toggle-row">
        <label class="cp-toggle-label">Ports Configurable as Backup</label>
        <label class="cp-mini-toggle">
          <input type="checkbox" id="cpProcessorBackup">
          <span class="cp-mini-toggle-slider"></span>
        </label>
      </div>
    </div>
    <div class="modal-footer modal-footer-gap">
      <button class="btn-secondary" onclick="closeCustomProcessorModal()">Cancel</button>
      <button class="btn-secondary" id="shareProcessorBtn" onclick="shareCustomProcessorToCommunity()" style="display: none;">Share to Community</button>
      <button class="btn-primary" onclick="saveCustomProcessor()">Save Processor</button>
    </div>
  </div>
</div>

<!-- Send to Jared Options Modal -->
<div id="sendToJaredModal" class="modal-overlay">
  <div class="modal-dialog modal-360">
    <div class="modal-header">
      <h2 class="modal-title">Send to Jared</h2>
      <button class="modal-close" onclick="closeSendToJaredModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p class="modal-hint">This will open your email app with the gear list.</p>
      <div class="checkbox-list">
        <label class="checkbox-label">
          <input type="checkbox" id="sendToJaredIncludeRP" checked>
          <span>Include RP Inventory File (.txt)</span>
        </label>
      </div>
      <p class="help-footnote">Tab-delimited file with gear codes for import into Rental Point or similar inventory software.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeSendToJaredModal()">Cancel</button>
      <button class="btn-primary" onclick="confirmSendToJared()">Send</button>
    </div>
  </div>
</div>

<!-- PDF Export Options Modal -->
<div id="pdfExportModal" class="modal-overlay">
  <div class="modal-dialog modal-360">
    <div class="modal-header">
      <h2 class="modal-title" id="pdfExportModalTitle">Export Options</h2>
      <button class="modal-close" onclick="closePdfExportModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p class="modal-hint">Select which sections to include:</p>
      <div class="checkbox-list">
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportSpecs" checked>
          <span>Specifications</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportGearList" checked>
          <span>Gear List</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportStandard" checked>
          <span>Standard Layout</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportPower" checked>
          <span>Power Layout</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportData" checked>
          <span>Data Layout</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportStructure" checked>
          <span>Structure Layout</span>
        </label>
      </div>
      <hr class="modal-divider">
      <p class="modal-hint">Print options:</p>
      <div class="checkbox-list">
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportEcoFriendly" onchange="if(this.checked) document.getElementById('pdfExportGreyscale').checked = false;">
          <span>Eco Friendly</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="pdfExportGreyscale" onchange="if(this.checked) document.getElementById('pdfExportEcoFriendly').checked = false;">
          <span>Greyscale</span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closePdfExportModal()">Cancel</button>
      <button class="btn-primary" id="pdfExportModalBtn" onclick="confirmPdfExport()">Export</button>
    </div>
  </div>
</div>

<!-- PWA Install Prompt Modal -->
<div id="pwaInstallModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title">Install B.L.I.N.K.</h2>
    </div>
    <div class="modal-body mb-14">
      <img src="icons/icon-192.png" alt="B.L.I.N.K." class="pwa-install-icon">
      <p class="modal-body-text">Install for offline use and a native app experience. Works without internet after first load.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closePwaInstallModal()">Not Now</button>
      <button class="btn-primary" onclick="confirmPwaInstall()">Install</button>
    </div>
  </div>
</div>

<!-- Custom Alert/Confirm Modal -->
<div id="customAlertModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title" id="customAlertTitle">Notice</h2>
    </div>
    <div class="modal-body mb-10">
      <p id="customAlertMessage" class="modal-body-text"></p>
      <input type="text" id="customAlertInput" class="alert-input-visible" style="display: none;" onkeydown="if(event.key==='Enter'){event.preventDefault();closeCustomAlert(true);}">
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" id="customAlertCancelBtn" onclick="closeCustomAlert(false)" style="display: none;">Cancel</button>
      <button class="btn-primary" id="customAlertOkBtn" onclick="closeCustomAlert(true)">OK</button>
    </div>
  </div>
</div>

<!-- Request Item Modal -->
<div id="requestItemModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title" id="requestItemModalTitle">Request Panel/Processor</h2>
      <button class="modal-close" onclick="closeRequestItemModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label>Request Type</label>
        <div class="slider-toggle mt-4">
          <button type="button" class="slider-toggle-btn slider-toggle-btn-tab active" id="requestTypePanelBtn" onclick="setRequestType('panel')">Panel</button>
          <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="requestTypeProcessorBtn" onclick="setRequestType('processor')">Processor</button>
          <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="requestTypeOtherBtn" onclick="setRequestType('other')">Other</button>
          <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="requestTypeFeatureBtn" onclick="setRequestType('feature')">Feature</button>
        </div>
      </div>

      <div id="requestItemFields">
        <div class="modal-input-group">
          <label>Brand / Manufacturer</label>
          <input type="text" id="requestBrand" placeholder="e.g., ROE Visual, Brompton, NovaStar">
        </div>

        <div class="modal-input-group">
          <label>Model Name</label>
          <input type="text" id="requestModel" placeholder="e.g., Black Pearl 2, Tessera SX40">
        </div>

        <div class="modal-input-group">
          <label>Additional Info (optional)</label>
          <textarea id="requestNotes" placeholder="Any other details, specs, or links to spec sheets..."></textarea>
        </div>
      </div>

      <div id="requestOtherFields" style="display: none;">
        <div class="modal-input-group">
          <label>Describe your request</label>
          <textarea id="requestOtherText" rows="10" class="textarea-tall" placeholder="I'd like to request..."></textarea>
        </div>
      </div>

      <div id="requestFeatureFields" style="display: none;">
        <div class="modal-input-group">
          <label>Describe your feature request</label>
          <textarea id="requestFeatureText" rows="10" class="textarea-tall" placeholder="I'd like to see..."></textarea>
        </div>
      </div>

      <div class="hint request-hint">
        This will open your email app with a pre-filled request.
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeRequestItemModal()">Cancel</button>
      <button class="btn-primary" onclick="sendItemRequest()">Send Request</button>
    </div>
  </div>
</div>

<!-- Manage Custom Items Modal -->
<div id="manageCustomModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title">Manage Custom Items</h2>
      <button class="modal-close" onclick="closeManageCustomModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="slider-toggle mb-12">
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab active" id="manageTabPanelsBtn" onclick="switchManageTab('panels')">Panels</button>
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="manageTabProcessorsBtn" onclick="switchManageTab('processors')">Processors</button>
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="manageTabCommunityBtn" onclick="switchManageTab('community')">Community</button>
      </div>
      <div id="manageCustomPanelsContent" class="manage-tab-content"></div>
      <div id="manageCustomProcessorsContent" class="manage-tab-content" style="display: none;"></div>
      <div id="manageCustomCommunityContent" class="manage-tab-content" style="display: none;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" onclick="closeManageCustomModal()">Done</button>
    </div>
  </div>
</div>

<!-- Community Browser Modal -->
<div id="communityBrowserModal" class="modal-overlay">
  <div class="modal-dialog modal-500">
    <div class="modal-header">
      <h2 class="modal-title">Community Library</h2>
      <button class="modal-close" onclick="closeCommunityBrowserModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="slider-toggle mb-12">
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab active" id="communityTabPanelsBtn" onclick="switchCommunityTab('panels')">Panels</button>
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="communityTabProcessorsBtn" onclick="switchCommunityTab('processors')">Processors</button>
      </div>
      <div id="communityPanelsContent" class="community-tab-content">
        <p class="loading-text">Loading...</p>
      </div>
      <div id="communityProcessorsContent" class="community-tab-content" style="display: none;">
        <p class="loading-text">Loading...</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeCommunityBrowserModal()">Close</button>
    </div>
  </div>
</div>

<!-- Gear Code Mapping Modal -->
<div id="gearCodeModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title">Gear Code Mapping</h2>
      <button class="modal-close" onclick="closeGearCodeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="slider-toggle gc-toggle-margin">
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab active" id="gcTabEquipmentBtn" onclick="switchGearCodeTab('equipment')">Equipment</button>
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="gcTabRiggingBtn" onclick="switchGearCodeTab('rigging')">Rigging</button>
        <button type="button" class="slider-toggle-btn slider-toggle-btn-tab" id="gcTabCablesBtn" onclick="switchGearCodeTab('cables')">Cables</button>
      </div>
      <div class="gc-search-row">
        <input type="text" id="gearCodeSearch" placeholder="Filter items..." oninput="filterGearCodeItems(this.value)" class="input-fw-bbox">
      </div>
      <div class="gc-scope-row">
        <label class="gc-scope-label">Scope:</label>
        <div class="slider-toggle flex-noshrink">
          <button type="button" class="slider-toggle-btn slider-toggle-btn-scope active" id="gcScopeGlobal" onclick="switchGearCodeScope('global')">Global</button>
          <button type="button" class="slider-toggle-btn slider-toggle-btn-scope" id="gcScopeProject" onclick="switchGearCodeScope('project')">This Project</button>
        </div>
      </div>
      <div id="gearCodeContent" class="gc-content-area"></div>
    </div>
    <div class="modal-footer">
      <div class="gc-footer-left">
        <button class="btn-secondary" onclick="document.getElementById('gearCodeImportInput').click()">Import File</button>
        <input type="file" id="gearCodeImportInput" accept=".txt,.csv,.tsv" style="display: none;" onchange="importGearCodesFromFile(event)">
        <button class="btn-secondary" onclick="exportGearCodes()">Export</button>
        <button class="btn-secondary btn-danger-text" onclick="clearGearCodes()">Clear</button>
      </div>
      <button class="btn-primary" onclick="closeGearCodeModal()">Done</button>
    </div>
  </div>
</div>

<!-- Mobile Header -->
<header class="mobile-header">
  <h1>CALCULATOR</h1>
  <div class="mobile-header-actions">
    <button class="mobile-header-btn" onclick="showWelcomePage()" title="Home">
      <span class="material-symbols-outlined">home</span>
    </button>
    <button class="mobile-header-btn" onclick="document.getElementById('loadConfigInput').click()" title="Load Config">
      <span class="material-symbols-outlined">folder</span>
    </button>
    <button class="mobile-header-btn" onclick="saveConfiguration()" title="Save Config">
      <span class="material-symbols-outlined">save</span>
    </button>
    <button class="mobile-header-btn" onclick="toggleMobileMenu()" title="Menu">
      <span class="material-symbols-outlined">menu</span>
    </button>
  </div>
</header>

<!-- Update Available Banner -->
<div id="updateBanner" class="update-banner">
  <span class="update-banner-text">New version <span id="updateVersionText"></span></span>
  <button class="update-banner-btn" onclick="hardRefreshApp()">Tap to Update</button>
  <button class="update-banner-close" onclick="hideUpdateBanner()">&times;</button>
</div>

<!-- Mobile Menu Overlay -->
<div id="mobileMenuOverlay" class="mobile-menu-overlay" onclick="closeMobileMenu()">
  <div class="mobile-menu" onclick="event.stopPropagation()">
    <div class="mobile-menu-header">
      <div class="mobile-menu-header-col">
        <span>Settings</span>
        <span id="menuVersionNumber"></span>
      </div>
      <button class="mobile-menu-refresh" onclick="hardRefreshApp();" title="Refresh App">&#x21bb;</button>
      <button class="mobile-menu-close" onclick="closeMobileMenu()">&times;</button>
    </div>
    <div class="mobile-menu-content">
      <div class="mobile-menu-section">
        <div class="mobile-menu-btn-row">
          <button class="mobile-menu-btn" onclick="closeMobileMenu(); showWelcomePage();">
            <span class="material-symbols-outlined icon-16-mr">home</span>
            Welcome
          </button>
          <button class="mobile-menu-btn install-btn" id="installPwaBtn" style="display: none;" onclick="installPwa()">
            <span class="material-symbols-outlined icon-16-mr">download</span>
            Install
          </button>
        </div>
      </div>
      <div class="mobile-menu-section">
        <div class="mobile-menu-label">Configuration</div>
        <input type="text" id="configName" placeholder="Config name..." class="mb-12">
        <div class="mobile-menu-btn-row">
          <button class="mobile-menu-btn" onclick="saveConfiguration(); closeMobileMenu();">Save</button>
          <button class="mobile-menu-btn" onclick="document.getElementById('loadConfigInput').click()">Load</button>
          <input type="file" id="loadConfigInput" accept=".blinkled,.led,.ledconfig" style="display: none;" onchange="loadConfiguration(event); closeMobileMenu();">
          <button class="mobile-menu-btn" onclick="modalOpenedFromMenu = true; showRecentProjects()">Recent</button>
        </div>
        <div class="mobile-menu-btn-row">
          <button id="btnExportPDF" class="mobile-menu-btn accent" onclick="closeMobileMenu();">Export</button>
          <button class="mobile-menu-btn accent" onclick="modalOpenedFromMenu = true; openSendToJaredModal(); closeMobileMenu();">Send to Jared</button>
        </div>
      </div>
      <div class="mobile-menu-section">
        <div class="mobile-menu-label">Custom Items</div>
        <div class="mobile-menu-btn-row">
          <button class="mobile-menu-btn" onclick="modalOpenedFromMenu = true; openCustomPanelModal(); closeMobileMenu();">Add Panel</button>
          <button class="mobile-menu-btn" onclick="modalOpenedFromMenu = true; openCustomProcessorModal(); closeMobileMenu();">Add Processor</button>
        </div>
        <div class="mobile-menu-btn-row">
          <button class="mobile-menu-btn accent" onclick="modalOpenedFromMenu = true; openManageCustomModal(); closeMobileMenu();">Manage Items</button>
          <button class="mobile-menu-btn" onclick="modalOpenedFromMenu = true; openProcessorRequestModal(); closeMobileMenu();">Requests</button>
        </div>
      </div>
      <div class="mobile-menu-section" id="mobileMenuInventorySection">
        <div class="mobile-menu-label">Inventory</div>
        <button class="mobile-menu-btn" onclick="modalOpenedFromMenu = true; openGearCodeModal(); closeMobileMenu();">Gear Code Mapping</button>
      </div>
      <div class="mobile-menu-section">
        <div class="mobile-menu-label mobile-menu-label-accent">App Info</div>
        <div class="mobile-menu-info">An LED wall calculator for planning LED video wall installations. Calculate equipment needs, visualize layouts, generate gear lists, and export detailed PDF reports.</div>
        <hr class="modal-divider-sm">
        <div class="mobile-menu-info">© 2025 Gabriel Labrecque<br>Fearless Wanderer Productions</div>
      </div>
    </div>
  </div>
</div>

<!-- Legacy page header (hidden on mobile) -->
<div class="page-header desktop-only">
  <div>
    <!-- Title and description hidden - they're in the background image -->
  </div>
  <div class="header-buttons-row">
    <div class="config-buttons">
      <button class="config-btn save" onclick="saveConfiguration()">💾 Save</button>
      <button class="config-btn load" onclick="document.getElementById('loadConfigInput').click()">📂 Load</button>
    </div>
  </div>
</div>


  <!-- Screen Tabs Container -->
  <div id="screenTabsContainer"><div id="screenAddBtn" class="screen-tab-add" onclick="addNewScreen()" title="Add new screen">+</div></div>

  <!-- Screen Rename Modal -->
  <div id="screenRenameModal" class="modal-overlay">
    <div class="modal-dialog modal-400">
      <div class="modal-header">
        <h2 class="modal-title">Edit Screen</h2>
        <button class="modal-close" onclick="closeScreenRenameModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-input-group">
          <label>Screen Name</label>
          <input type="text" id="screenRenameInput" placeholder="e.g., Main IMAG">
        </div>
        <div class="modal-input-group">
          <label>Primary Color</label>
          <div class="color-picker-row">
            <input type="color" id="screenColorInput" class="color-picker-input">
            <span id="screenColorPreview" class="color-preview"></span>
          </div>
        </div>
        <div class="modal-input-group">
          <label>Secondary Color</label>
          <div class="color-picker-row">
            <input type="color" id="screenColor2Input" class="color-picker-input">
            <span id="screenColor2Preview" class="color-preview"></span>
          </div>
          <div class="hint">Panels alternate between primary and secondary colors in Standard Layout and Canvas View</div>
        </div>
      </div>
      <div class="modal-footer modal-footer-end">
        <button class="btn-secondary" onclick="closeScreenRenameModal()">Cancel</button>
        <button class="btn-primary" onclick="saveScreenRename()">Save</button>
        <button class="btn-secondary btn-duplicate" onclick="duplicateScreen()">Duplicate</button>
      </div>
    </div>
  </div>

  <div class="main-container">
    <div class="two-column-layout">
      
      <!-- LEFT COLUMN -->
      <div>
        
        <!-- Panel Type -->
        <div class="section-box" id="panelTypeSection">
          <div class="section-title">Panel Type</div>
          <label class="mb-0">
            <select id="panelType" class="select-fw-14">
              <option value="BP2_V2">ROE Black Pearl BP2 V2</option>
              <option value="CB5_MKII">ROE Carbon CB5 MKII</option>
              <option value="CB5_MKII_HALF">ROE Carbon CB5 MKII Half</option>
              <option value="MC7H">ROE MC7H</option>
              <option value="BO3">ROE Black Onyx BO3</option>
              <option value="BM4_MATTE">ROE Black Marble BM4</option>
              <option value="DM2_6">ROE DM2.6</option>
              <option value="INFILED_AMT8_3">INFiLED AMT 8.3</option>
            </select>
          </label>
          <!-- CB5 Half Panel Row Toggle (only visible when CB5 MKII is selected) -->
          <div id="cb5HalfPanelToggle" class="mt-8" style="display: none;">
            <div class="toggle-group">
              <button type="button" class="toggle-btn" id="addCB5HalfRowBtn" onclick="toggleCB5HalfRow()">+ Half Panel Row</button>
            </div>
          </div>
        </div>

        <!-- Connecting Plates Section (CB5 MKII / DM2.6) -->
        <div id="connectingPlatesSection" class="mt-8" style="display: none;">
          <div class="section-box">
            <div class="section-title">Panel Connection Method</div>
            
            <!-- CB5 MKII can choose -->
            <div id="cb5ConnectionChoice" style="display: none;">
              <div class="toggle-group">
                <button type="button" class="toggle-btn active" id="connectionAirframeBtn" onclick="setConnectionMethod('airframe')">Air Frame</button>
                <button type="button" class="toggle-btn" id="connectionPlatesBtn" onclick="setConnectionMethod('plates')">Plates</button>
              </div>
            </div>
            
            <!-- DM2.6 always uses plates -->
            <div id="dm26ConnectionInfo" style="display: none;">
              <button type="button" class="toggle-btn active toggle-btn-disabled">Connecting Plates</button>
              <div class="hint hint-muted">
                DM2.6 panels use connecting plates only
              </div>
            </div>
            
            <!-- Plate Weight Inputs (hidden - now auto-calculated) -->
            <div id="plateWeightInputs" style="display: none;">
              <!-- Plate weights are now automatically calculated:
                   2-Way Plate: 0.5 kg each
                   4-Way Plate: 0.8 kg each
              -->
            </div>
          </div>
        </div>

        <!-- Dimensions Section -->
        <div class="section-box">
          <div class="section-title">Dimensions</div>

          <div class="dimension-toggles-row">
            <div class="slider-toggle">
              <button type="button" class="slider-toggle-btn active" id="dimModePanelsBtn" onclick="setDimensionMode('panels')">Panels</button>
              <button type="button" class="slider-toggle-btn" id="dimModeSizeBtn" onclick="setDimensionMode('size')">Size</button>
            </div>
            <div class="slider-toggle">
              <button type="button" class="slider-toggle-btn active" id="unitImperial" onclick="setUnitSystem('imperial')">Imperial</button>
              <button type="button" class="slider-toggle-btn" id="unitMetric" onclick="setUnitSystem('metric')">Metric</button>
            </div>
          </div>

          <!-- Aspect Ratio Lock -->
          <div class="mb-12">
            <span class="toggle-label toggle-label-10">Aspect Ratio Lock <span id="arHint" style="display: none;">(input width for auto height)</span></span>
            <div class="slider-toggle">
              <button type="button" class="slider-toggle-btn active" id="arNoneBtn" onclick="setAspectRatio('none')">None</button>
              <button type="button" class="slider-toggle-btn" id="ar169Btn" onclick="setAspectRatio('16:9')">16:9</button>
              <button type="button" class="slider-toggle-btn" id="ar43Btn" onclick="setAspectRatio('4:3')">4:3</button>
              <button type="button" class="slider-toggle-btn" id="arCustomBtn" onclick="setAspectRatio('custom')">Custom</button>
            </div>
            <!-- Custom Aspect Ratio Inputs (hidden by default) -->
            <div id="customAspectRatioInputs" class="mt-8" style="display: none;">
              <div class="two-inputs max-w-160">
                <label>
                  <span>Width</span>
                  <input type="number" id="customARWidth" min="1" placeholder="16" class="input-placeholder-color" onfocus="this.style.color='#fff'" onblur="if(!this.value)this.style.color='#6b7280'">
                </label>
                <label>
                  <span>Height</span>
                  <input type="number" id="customARHeight" min="1" placeholder="10" class="input-placeholder-color" onfocus="this.style.color='#fff'" onblur="if(!this.value)this.style.color='#6b7280'">
                </label>
              </div>
            </div>
          </div>

          <div id="panelCountInputs">
            <div class="two-inputs max-w-200">
              <label>
                <span>Panels Wide</span>
                <input type="number" id="panelsWide" min="1">
              </label>
              <label>
                <span>Panels High</span>
                <input type="number" id="panelsHigh" min="1">
              </label>
            </div>
          </div>

          <div id="wallSizeInputs" style="display: none;">
            <div class="two-inputs max-w-200">
              <label>
                <span>Wall Width</span>
                <input type="number" id="wallWidth" min="0.1" step="0.01">
              </label>
              <label>
                <span>Wall Height</span>
                <input type="number" id="wallHeight" min="0.1" step="0.01">
              </label>
            </div>
          </div>
        </div>

        <!-- Power Section -->
        <div class="section-box" id="powerSection">
          <div class="section-title">Power</div>

          <!-- Row 1: Power Basis and Phase toggles -->
          <div class="compact-row mb-12">
            <div class="flex-noshrink">
              <span class="toggle-label toggle-label-block">Power Basis</span>
              <div class="slider-toggle">
                <button type="button" class="slider-toggle-btn active" id="powerMaxBtn" onclick="setPowerType('max')">Max</button>
                <button type="button" class="slider-toggle-btn" id="powerAvgBtn" onclick="setPowerType('avg')">Avg</button>
              </div>
              <select id="powerType" style="display: none;">
                <option value="max" selected>Max</option>
                <option value="avg">Average</option>
              </select>
            </div>
            <div class="flex-noshrink">
              <span class="toggle-label toggle-label-block">Phase</span>
              <div class="slider-toggle">
                <button type="button" class="slider-toggle-btn active" id="phase3Btn" onclick="setPhase(3)">3Ø</button>
                <button type="button" class="slider-toggle-btn" id="phase1Btn" onclick="setPhase(1)">1Ø</button>
              </div>
              <select id="phase" style="display: none;">
                <option value="1">1-phase</option>
                <option value="3" selected>3-phase</option>
              </select>
            </div>
          </div>

          <!-- Row 2: Voltage, Breaker, Max/Circuit -->
          <div class="compact-row">
            <div class="flex-noshrink">
              <span class="toggle-label toggle-label-block">Voltage</span>
              <div class="number-input-with-arrows">
                <input type="number" id="voltage" value="208">
                <div class="number-input-arrows">
                  <button type="button" onclick="adjustNumberInput('voltage', 1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                  </button>
                  <button type="button" onclick="adjustNumberInput('voltage', -1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="flex-noshrink">
              <span class="toggle-label toggle-label-block">Breaker</span>
              <div class="number-input-with-arrows">
                <input type="number" id="breaker" value="20">
                <div class="number-input-arrows">
                  <button type="button" onclick="adjustNumberInput('breaker', 1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                  </button>
                  <button type="button" onclick="adjustNumberInput('breaker', -1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="flex-noshrink">
              <span class="toggle-label toggle-label-block">Max/Circuit</span>
              <div class="number-input-with-arrows">
                <input type="number" id="maxPanelsPerCircuit" min="1" step="1" placeholder="21">
                <div class="number-input-arrows">
                  <button type="button" onclick="adjustNumberInput('maxPanelsPerCircuit', 1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                  </button>
                  <button type="button" onclick="adjustNumberInput('maxPanelsPerCircuit', -1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Data Section -->
        <div class="section-box" id="dataSection">
          <div class="section-title">Data</div>

          <!-- Row 1: Processor -->
          <div class="mb-8">
            <label class="mb-0">
              <span>Processor</span>
              <select id="processor" class="w-full">
                <option value="Brompton_SX40">Brompton SX40</option>
                <option value="Brompton_S8">Brompton S8</option>
                <option value="Brompton_M2">Brompton M2</option>
                <option value="Brompton_S4">Brompton S4</option>
                <option value="Brompton_T1">Brompton T1</option>
                <option value="Brompton_SQ200">Brompton SQ200</option>
                <option value="NovaStar_MX40_Pro">NovaStar MX40 Pro</option>
              </select>
            </label>
          </div>

          <!-- Direct/Indirect Mode Toggle (MX40 Pro only) -->
          <div id="mx40ModeToggleRow" class="mb-8" style="display: none;">
            <span class="toggle-label toggle-label-10">Connection Mode</span>
            <div class="slider-toggle d-inline-flex">
              <button type="button" class="slider-toggle-btn slider-toggle-btn-xs active" id="mx40DirectBtn" onclick="setMX40Mode('direct')">Direct</button>
              <button type="button" class="slider-toggle-btn slider-toggle-btn-xs" id="mx40IndirectBtn" onclick="setMX40Mode('indirect')">Indirect</button>
            </div>
          </div>

          <!-- Row 2: Frame Rate, Bit Depth, Max/Data -->
          <div class="compact-row compact-row-nowrap">
            <div class="flex-1-minw0">
              <span class="toggle-label toggle-label-10">Frame Rate</span>
              <select id="frameRate" class="select-fw-14">
                <option value="24">24 Hz</option>
                <option value="25">25 Hz</option>
                <option value="30">30 Hz</option>
                <option value="50">50 Hz</option>
                <option value="60" selected>60 Hz</option>
              </select>
            </div>
            <div class="flex-1-minw0">
              <span class="toggle-label toggle-label-10">Bit Depth</span>
              <select id="bitDepth" class="select-fw-14">
                <option value="8" selected>8 bit</option>
                <option value="10">10 bit</option>
                <option value="12">12 bit</option>
              </select>
            </div>
            <div class="flex-1-minw0">
              <span class="toggle-label toggle-label-block">Max/Data</span>
              <div class="number-input-with-arrows w-full">
                <input type="number" id="maxPanelsPerData" min="1" step="1" placeholder="Auto">
                <div class="number-input-arrows">
                  <button type="button" onclick="adjustNumberInput('maxPanelsPerData', 1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                  </button>
                  <button type="button" onclick="adjustNumberInput('maxPanelsPerData', -1)">
                    <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Row 3: Data Direction (complex mode only) -->
          <div id="dataDirectionRow" class="mb-8">
            <label class="mb-0">
              <span>Data Direction</span>
              <select id="dataStartDir" class="w-full">
                <option value="top">Top → Bottom</option>
                <option value="bottom">Bottom → Top</option>
                <option value="all_top">All from Top</option>
                <option value="all_bottom">All from Bottom</option>
              </select>
            </label>
          </div>

          <!-- Row 4: Toggle buttons (complex mode only) -->
          <div id="dataTogglesRow" class="toggle-group toggle-group-6">
            <div class="grouped-btn-shadow">
              <button type="button" class="toggle-btn active toggle-btn-grouped-left" id="showArrowsBtn" onclick="toggleShowArrows()">Arrows</button>
              <button type="button" class="toggle-btn toggle-btn-grouped-right" id="dataFlipBtn" onclick="toggleDataFlip()">Flip</button>
            </div>
            <button type="button" class="toggle-btn active toggle-btn-standalone" id="redundancyBtn" onclick="toggleRedundancy()">Data Redun.</button>
            <button type="button" class="toggle-btn toggle-btn-standalone" id="processorRedundancyBtn" onclick="toggleProcessorRedundancy()">Proc Redun.</button>
          </div>
        </div>

      </div>

      <!-- RIGHT COLUMN -->
      <div>
        
        <!-- Structure Section -->
        <div class="section-box" id="structureSection">
          <div class="section-title">Structure</div>

          <div class="mb-8">
            <label class="label-block-mb8">
              <span>Config Type</span>
              <select id="structureType" class="w-full max-w-180">
                <option value="hanging">Hanging</option>
                <option value="ground">Ground Stack</option>
                <option value="floor">Floor</option>
              </select>
            </label>
            <!-- Bumper Toggles Row -->
            <div class="toggle-group toggle-group-6">
              <button type="button" class="toggle-btn active toggle-btn-standalone" id="useBumpersBtn" onclick="toggleUseBumpers()">Bumpers</button>
              <span id="fourWayBumperOption" style="display: none;">
                <button type="button" class="toggle-btn toggle-btn-standalone" id="use4WayBumpersBtn" onclick="toggle4WayBumpers()">4-Way Bumpers</button>
              </span>
            </div>
          </div>
          
          <!-- Bumper Controls -->
          <div id="bumperControls">
            <div class="hint hint-compact">
              Long-press bumpers to edit • Auto-distributes by width
            </div>
          </div>
          
          <!-- Weight Display -->
          <div id="weightDisplay" class="weight-display" style="display: none;">
            <div class="weight-title">Weight Distribution</div>
            <div id="weightContent"></div>
          </div>
        </div>
        
        <!-- Cabling section moved to Gear tab -->

      </div>

    </div>

    <div id="results" class="result">Configure your LED wall above - results update automatically.</div>
    <div id="specWarning" class="warn"></div>

    <div class="layout-container" id="standardContainer" style="display:none;">
      <div class="layout-title">
        <span>Standard Layout<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('standardContainer')" id="standardCollapseBtn" title="Minimize">▼</button></span>
        <div class="undo-redo-buttons">
          <button class="undo-redo-btn" id="undoBtn" onclick="undo()" title="Undo">Undo</button>
          <button class="undo-redo-btn" id="redoBtn" onclick="redo()" title="Redo">Redo</button>
        </div>
      </div>
      <div class="layout-content" id="standardContent">
        <div class="mobile-hint" id="standardLayoutHint">Tap to select • Tap again for options • Drag to multi-select</div>
        <canvas id="standardCanvas"></canvas>
      </div>
    </div>

    <div class="layout-container" id="powerContainer" style="display:none;">
      <div class="layout-title">
        <span>Power Layout<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('powerContainer')" id="powerCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="powerContent">
        <canvas id="powerCanvas"></canvas>
      </div>
    </div>

    <div class="layout-container" id="dataContainer" style="display:none;">
      <div class="layout-title">
        <span>Data Layout<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('dataContainer')" id="dataCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="dataContent">
        <canvas id="dataCanvas"></canvas>
      </div>
    </div>

    <div class="layout-container" id="structureContainer" style="display:none;">
      <div class="layout-title">
        <span>Structure Layout<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('structureContainer')" id="structureCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="structureContent">
      <!-- Manual Mode Toggle -->
      <div class="structure-mode-toggle">
        <button type="button" class="toggle-btn toggle-btn-standalone" id="manualBumperToggle" onclick="toggleManualBumperMode()">
          Manually Distribute Bumpers
        </button>
        <div class="undo-redo-buttons" id="structureUndoRedo" style="display: none;">
          <button class="undo-redo-btn toggle-btn-standalone" id="structureUndoBtn" onclick="structureUndo()" title="Undo (Ctrl+Z)">Undo</button>
          <button class="undo-redo-btn toggle-btn-standalone" id="structureRedoBtn" onclick="structureRedo()" title="Redo (Ctrl+Y)">Redo</button>
        </div>
        <span class="structure-mode-hint" id="structureModeHint">Auto-distribution active</span>
      </div>
      
      <!-- Selection Info (shown in manual mode) -->
      <div class="structure-selection-info" id="structureSelectionInfo">
        <strong>Manual Mode:</strong> <span id="structureHintText">Tap to select • Tap again for options • Hold to drag</span>
      </div>
      
      <!-- Structure layout with canvas and info panel side by side -->
      <div class="structure-layout-wrapper">
        <div class="structure-canvas-area">
          <canvas id="structureCanvas"></canvas>
        </div>
        
        <!-- Info Panel with Weights and Plates -->
        <div class="structure-info-panel" id="structureInfoPanel" style="display: none;">
          <!-- Pickup Weights -->
          <div class="structure-info-box weights" id="structureWeightsBox">
            <div class="structure-info-title weights">Pickup Weights</div>
            <div id="structureWeightsContent"></div>
          </div>
          
          <!-- Connecting Plates -->
          <div class="structure-info-box plates" id="structurePlatesBox" style="display: none;">
            <div class="structure-info-title plates">Connecting Plates</div>
            <div id="structurePlatesContent"></div>
          </div>
          
          <!-- Ground Support Hardware -->
          <div class="structure-info-box ground-support" id="structureGroundSupportBox" style="display: none;">
            <div class="structure-info-title ground-support">Ground Support Hardware</div>
            <div id="structureGroundSupportContent"></div>
          </div>

          <!-- Floor Frames -->
          <div class="structure-info-box floor-frames" id="structureFloorFramesBox" style="display: none;">
            <div class="structure-info-title floor-frames">Floor Frames</div>
            <div id="structureFloorFramesContent"></div>
          </div>

          <!-- Total Structure Weight -->
          <div class="structure-info-box total-weight" id="structureTotalWeightBox" style="display: none;">
            <div class="structure-info-title total-weight">Total Structure Weight</div>
            <div id="structureTotalWeightContent"></div>
          </div>
        </div>
      </div>
      
      <!-- Context Menu for Bumpers -->
      <div id="bumperContextMenu" style="display:none;">
        <div class="context-menu-item" onclick="changeBumperType('1w')">Change to 1W</div>
        <div class="context-menu-item" onclick="changeBumperType('2w')">Change to 2W</div>
        <div class="context-menu-item btn-delete-text" onclick="deleteBumper()">Delete Bumper</div>
      </div>
      </div>
    </div>
    
    <!-- Layouts Toggle Bar (for mobile layouts view) -->
    <div id="layoutsTogglesContainer" class="layouts-toggle-container" style="display: none;">
      <div class="toggle-group">
        <button type="button" class="toggle-btn active" id="layoutToggleStandard" onclick="showMobileLayout('standard')">Standard</button>
        <button type="button" class="toggle-btn" id="layoutTogglePower" onclick="showMobileLayout('power')">Power</button>
        <button type="button" class="toggle-btn" id="layoutToggleData" onclick="showMobileLayout('data')">Data</button>
        <button type="button" class="toggle-btn" id="layoutToggleStructure" onclick="showMobileLayout('structure')">Structure</button>
      </div>
    </div>

  </div>

<!-- Gear List Container (outside main-container so it can be shown as its own tab) -->
<div class="layout-container gear-list-layout" id="gearListContainer" style="display:none;">
  <!-- Screen Tabs (pulled above container border) -->
  <div id="gearScreenToggles">
    <!-- Dynamically generated screen-tab style tabs -->
  </div>

  <!-- Cabling Section -->
  <div class="section-box mb-16" id="cablingSection">
    <div class="section-title">Cabling</div>

    <div class="cabling-grid cabling-3col">
      <!-- Column 1: General -->
      <div>
        <div class="cabling-header cabling-header-general">General</div>
        <div class="cabling-inputs-2col">
          <label class="mb-2">
            <span>Wall to Floor</span>
            <input type="number" id="wallToFloor" min="0" step="0.1" placeholder="5">
          </label>
          <label class="mb-2">
            <span>Cable Pick</span>
            <input type="number" id="cablePick" min="0" step="0.1" placeholder="0">
          </label>
        </div>
        <div class="cabling-subsection">
          <span class="toggle-label toggle-label-block-2">Cable Drop</span>
          <div class="slider-toggle">
            <button type="button" class="slider-toggle-btn active" id="cableDropBehindBtn" onclick="setCableDropPosition('behind')">Behind</button>
            <button type="button" class="slider-toggle-btn" id="cableDropSRBtn" onclick="setCableDropPosition('sr')">SR</button>
            <button type="button" class="slider-toggle-btn" id="cableDropSLBtn" onclick="setCableDropPosition('sl')">SL</button>
          </div>
        </div>
      </div>

      <!-- Column 2: Power -->
      <div>
        <div class="cabling-header cabling-header-power">Power</div>
        <label class="mb-2">
          <span>Distro to Drop</span>
          <input type="number" id="distroToWall" min="0" step="0.1" placeholder="10">
        </label>
        <div class="cabling-subsection">
          <span class="toggle-label toggle-label-block-2">Power In</span>
          <div class="slider-toggle">
            <button type="button" class="slider-toggle-btn active" id="powerInTopBtn" onclick="setPowerInPosition('top')">Top</button>
            <button type="button" class="slider-toggle-btn" id="powerInBottomBtn" onclick="setPowerInPosition('bottom')">Bottom</button>
          </div>
        </div>
      </div>

      <!-- Column 3: Data -->
      <div>
        <div class="cabling-data-grid cabling-data-2col">
          <div class="cabling-header-data-inline">Data</div>
          <div class="cabling-pl-6">
            <label id="distBoxOnWallLabel" class="dist-box-label" onclick="toggleDistBoxOnWall()">
              Dist Box
              <span class="dist-box-check" id="distBoxOnWallCheck"></span>
            </label>
          </div>
          <div class="cabling-divider">
            <label class="mb-4">
              <span>Proc to Drop</span>
              <input type="number" id="processorToWall" min="0" step="0.1" placeholder="15">
            </label>
            <label class="mb-2">
              <span>Server to Proc</span>
              <input type="number" id="serverToProcessor" min="0" step="0.1" placeholder="50">
            </label>
          </div>
          <div class="cabling-divider-indent">
            <div id="distBoxPositionControls" style="display: none;">
              <!-- Main -->
              <span class="toggle-label toggle-label-block">Main</span>
              <div class="dist-box-row-mb">
                <div class="slider-toggle">
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="distBoxMainHorizSRBtn" onclick="setDistBoxMainHorizPosition('sr')">SR</button>
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="distBoxMainHorizCBtn" onclick="setDistBoxMainHorizPosition('center')">C</button>
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="distBoxMainHorizSLBtn" onclick="setDistBoxMainHorizPosition('sl')">SL</button>
                </div>
                <div class="slider-toggle">
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="distBoxMainTopBtn" onclick="setDistBoxMainVertPosition('top')">Top</button>
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="distBoxMainBottomBtn" onclick="setDistBoxMainVertPosition('bottom')">Bot</button>
                </div>
              </div>
              <!-- Backup -->
              <span class="toggle-label toggle-label-block">Backup</span>
              <div class="dist-box-row">
                <div class="slider-toggle">
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="distBoxBackupHorizSRBtn" onclick="setDistBoxBackupHorizPosition('sr')">SR</button>
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="distBoxBackupHorizCBtn" onclick="setDistBoxBackupHorizPosition('center')">C</button>
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="distBoxBackupHorizSLBtn" onclick="setDistBoxBackupHorizPosition('sl')">SL</button>
                </div>
                <div class="slider-toggle">
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="distBoxBackupTopBtn" onclick="setDistBoxBackupVertPosition('top')">Top</button>
                  <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="distBoxBackupBottomBtn" onclick="setDistBoxBackupVertPosition('bottom')">Bot</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="cableDiagramContainer" class="cable-diagram-wrap">
    <canvas id="cableDiagramCanvas"></canvas>
  </div>

  <div id="gearListContent" class="content-text-padded"></div>
</div>

<!-- Combined View Container (outside main-container so it can be shown independently) -->
<div class="layout-container combined-layout" id="combinedContainer" style="display:none;">
  <!-- Combined View Title -->
  <div class="layout-title"><span>Combined View</span></div>
  <!-- Hint Box -->
  <div class="combined-hint-box">
    Toggle screens below to view combined specs
  </div>

  <!-- Screen Toggle Buttons -->
  <div id="combinedScreenToggles">
    <!-- Screen toggle buttons will be dynamically generated here -->
  </div>

  <!-- Combined Layouts Container -->
  <div id="combinedLayoutsWrapper" class="combined-layouts-wrap">
    <!-- Standard Layout -->
    <div class="layout-container mb-20" id="combinedStandardContainer">
      <div class="layout-title">
        <span>Standard Layout (Combined)<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedStandardContainer')" id="combinedStandardCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="combinedStandardContent">
        <!-- Interaction Hints -->
        <div id="combinedInteractionHints" class="combined-interaction-hints">
          <span id="combinedHintsDesktop" style="display: none;"><strong>Panels:</strong> Right-click for options, double-click to delete/restore &nbsp;|&nbsp; <strong>Screens:</strong> Enable Manual Adjust, then drag to move</span>
          <span id="combinedHintsMobile" style="display: none;"><strong>Panels:</strong> Tap to select, tap again for options &nbsp;|&nbsp; <strong>Screens:</strong> Enable Manual Adjust, then drag to move</span>
        </div>
        <!-- Position Controls -->
        <div id="combinedPositionControls">
          <div class="slider-toggle d-inline-flex">
            <button type="button" class="slider-toggle-btn" id="resetPositionsBtn" onclick="resetCombinedPositions()">Reset</button>
            <button type="button" class="slider-toggle-btn" id="manualAdjustBtn" onclick="toggleManualAdjust()">Manual Adjust</button>
          </div>
          <!-- Zoom Controls (slider-toggle style to match Reset/Manual Adjust) -->
          <div class="slider-toggle d-inline-flex">
            <button type="button" class="slider-toggle-btn" onclick="adjustCombinedZoom(-10)" title="Zoom Out" class="combined-zoom-btn">−</button>
            <input type="number" id="combinedZoomInput" value="100" min="50" max="200" step="10" onchange="setCombinedZoom(parseInt(this.value))" title="Enter zoom percentage">
            <button type="button" class="slider-toggle-btn" onclick="adjustCombinedZoom(10)" title="Zoom In" class="combined-zoom-btn-plus">+</button>
          </div>
        </div>
        <div id="combinedStandardCanvasWrapper" class="overflow-x-auto">
          <canvas id="combinedStandardCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- Power Layout -->
    <div class="layout-container mb-20" id="combinedPowerContainer">
      <div class="layout-title">
        <span>Power Layout (Combined)<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedPowerContainer')" id="combinedPowerCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="combinedPowerContent">
        <div id="combinedPowerCanvasWrapper" class="overflow-x-auto">
          <canvas id="combinedPowerCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- Data Layout -->
    <div class="layout-container mb-20" id="combinedDataContainer">
      <div class="layout-title">
        <span>Data Layout (Combined)<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedDataContainer')" id="combinedDataCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="combinedDataContent">
        <div id="combinedDataCanvasWrapper" class="overflow-x-auto">
          <canvas id="combinedDataCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- Structure Layout -->
    <div class="layout-container mb-20" id="combinedStructureContainer">
      <div class="layout-title">
        <span>Structure Layout (Combined)<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedStructureContainer')" id="combinedStructureCollapseBtn" title="Minimize">▼</button></span>
      </div>
      <div class="layout-content" id="combinedStructureContent">
        <div id="combinedStructureCanvasWrapper" class="overflow-x-auto">
          <canvas id="combinedStructureCanvas"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Cabling Layout -->
  <div class="layout-container mb-20" id="combinedCablingContainer">
    <div class="layout-title">
      <span>Cabling Layout (Combined)<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedCablingContainer')" id="combinedCablingCollapseBtn" title="Minimize">▼</button></span>
    </div>
    <div class="layout-content" id="combinedCablingContent">
      <!-- Cabling Input Controls (matches gear tab layout) -->
      <div class="cabling-grid cabling-3col mb-16">
        <!-- Column 1: General -->
        <div>
          <div class="cabling-header cabling-header-general">General</div>
          <div class="cabling-inputs-2col">
            <label class="mb-2">
              <span>Wall to Floor</span>
              <input type="number" id="combinedCablingWallToFloor" min="0" step="0.1" value="5" oninput="updateCombinedCablingFromInputs()">
            </label>
            <label class="mb-2">
              <span>Cable Pick</span>
              <input type="number" id="combinedCablingCablePick" min="0" step="0.1" value="0" oninput="updateCombinedCablingFromInputs()">
            </label>
          </div>
          <div class="cabling-subsection">
            <span class="toggle-label toggle-label-block-2">Cable Drop</span>
            <div class="slider-toggle">
              <button type="button" class="slider-toggle-btn active" id="combinedCableDropBehindBtn" onclick="setCombinedCableDropPosition('behind')">Behind</button>
              <button type="button" class="slider-toggle-btn" id="combinedCableDropSrBtn" onclick="setCombinedCableDropPosition('sr')">SR</button>
              <button type="button" class="slider-toggle-btn" id="combinedCableDropSlBtn" onclick="setCombinedCableDropPosition('sl')">SL</button>
            </div>
          </div>
        </div>

        <!-- Column 2: Power -->
        <div>
          <div class="cabling-header cabling-header-power">Power</div>
          <label class="mb-2">
            <span>Distro to Drop</span>
            <input type="number" id="combinedCablingDistroToWall" min="0" step="0.1" value="10" oninput="updateCombinedCablingFromInputs()">
          </label>
          <div class="cabling-subsection">
            <span class="toggle-label toggle-label-block-2">Power In</span>
            <div class="slider-toggle">
              <button type="button" class="slider-toggle-btn active" id="combinedPowerInTopBtn" onclick="setCombinedPowerInPosition('top')">Top</button>
              <button type="button" class="slider-toggle-btn" id="combinedPowerInBottomBtn" onclick="setCombinedPowerInPosition('bottom')">Bottom</button>
            </div>
          </div>
        </div>

        <!-- Column 3: Data -->
        <div>
          <div class="cabling-data-grid cabling-data-2col">
            <div class="cabling-header-data-inline">Data</div>
            <div class="cabling-pl-6">
              <label id="combinedDistBoxOnWallLabel" class="dist-box-label" onclick="toggleCombinedDistBoxOnWall()">
                Dist Box
                <span class="dist-box-check" id="combinedDistBoxOnWallCheck"></span>
              </label>
            </div>
            <div class="cabling-divider">
              <label class="mb-4">
                <span>Proc to Drop</span>
                <input type="number" id="combinedCablingProcessorToWall" min="0" step="0.1" value="15" oninput="updateCombinedCablingFromInputs()">
              </label>
              <label class="mb-2">
                <span>Server to Proc</span>
                <input type="number" id="combinedCablingServerToProc" min="0" step="0.1" value="50" oninput="updateCombinedCablingFromInputs()">
              </label>
            </div>
            <div class="cabling-divider-indent">
              <div id="combinedDistBoxPositionControls" style="display: none;">
                <!-- Main -->
                <span class="toggle-label toggle-label-block">Main</span>
                <div class="dist-box-row-mb">
                  <div class="slider-toggle">
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="combinedDistBoxMainHorizSRBtn" onclick="setCombinedDistBoxMainHorizPosition('sr')">SR</button>
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="combinedDistBoxMainHorizCBtn" onclick="setCombinedDistBoxMainHorizPosition('center')">C</button>
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="combinedDistBoxMainHorizSLBtn" onclick="setCombinedDistBoxMainHorizPosition('sl')">SL</button>
                  </div>
                  <div class="slider-toggle">
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="combinedDistBoxMainTopBtn" onclick="setCombinedDistBoxMainVertPosition('top')">Top</button>
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="combinedDistBoxMainBottomBtn" onclick="setCombinedDistBoxMainVertPosition('bottom')">Bot</button>
                  </div>
                </div>
                <!-- Backup -->
                <span class="toggle-label toggle-label-block">Backup</span>
                <div class="dist-box-row">
                  <div class="slider-toggle">
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="combinedDistBoxBackupHorizSRBtn" onclick="setCombinedDistBoxBackupHorizPosition('sr')">SR</button>
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="combinedDistBoxBackupHorizCBtn" onclick="setCombinedDistBoxBackupHorizPosition('center')">C</button>
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="combinedDistBoxBackupHorizSLBtn" onclick="setCombinedDistBoxBackupHorizPosition('sl')">SL</button>
                  </div>
                  <div class="slider-toggle">
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm active" id="combinedDistBoxBackupTopBtn" onclick="setCombinedDistBoxBackupVertPosition('top')">Top</button>
                    <button type="button" class="slider-toggle-btn slider-toggle-btn-sm" id="combinedDistBoxBackupBottomBtn" onclick="setCombinedDistBoxBackupVertPosition('bottom')">Bot</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Cable Diagram Canvas -->
      <div id="combinedCableDiagramCanvasWrapper" class="overflow-x-auto">
        <canvas id="combinedCableDiagramCanvas"></canvas>
      </div>
    </div>
  </div>

  <!-- Combined Specs -->
  <div class="layout-container mb-20" id="combinedSpecsContainer">
    <div class="layout-title">
      <span>Combined Specifications<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedSpecsContainer')" id="combinedSpecsCollapseBtn" title="Minimize">▼</button></span>
    </div>
    <div class="layout-content" id="combinedSpecsLayoutContent">
      <div id="combinedSpecsToggles" class="compact-row combined-specs-layout" style="display: none;">
        <div class="flex-noshrink">
          <span class="toggle-label toggle-label-block">Power Basis</span>
          <div class="slider-toggle">
            <button type="button" class="slider-toggle-btn active" id="combinedPowerMaxBtn" onclick="setCombinedPowerType('max')">Max</button>
            <button type="button" class="slider-toggle-btn" id="combinedPowerAvgBtn" onclick="setCombinedPowerType('avg')">Avg</button>
          </div>
        </div>
        <div class="flex-noshrink">
          <span class="toggle-label toggle-label-block">Phase</span>
          <div class="slider-toggle">
            <button type="button" class="slider-toggle-btn active" id="combinedPhase3Btn" onclick="setCombinedPhase(3)">3Ø</button>
            <button type="button" class="slider-toggle-btn" id="combinedPhase1Btn" onclick="setCombinedPhase(1)">1Ø</button>
          </div>
        </div>
      </div>
      <div id="combinedSpecsContent" class="content-text"></div>
    </div>
  </div>

  <!-- Combined Gear List -->
  <div class="layout-container mb-20" id="combinedGearListContainer">
    <div class="layout-title">
      <span>Gear List<button class="layout-collapse-btn" onclick="toggleLayoutCollapse('combinedGearListContainer')" id="combinedGearListCollapseBtn" title="Minimize">▼</button></span>
    </div>
    <div class="layout-content" id="combinedGearListLayoutContent">
      <div id="combinedGearListContent" class="content-text-padded"></div>
    </div>
  </div>

</div>

<!-- Canvas Tabs Container (outside canvas container, normal flow like screen tabs) -->
<div id="canvasTabsContainer" class="canvas-tabs-layout" style="display: none;">
  <!-- Canvas tabs and + button will be dynamically generated here -->
</div>

<!-- Canvas Container (outside main-container so it can be shown independently) -->
<div class="layout-container canvas-container-layout" id="canvasContainer" style="display:none;">
  <!-- Canvas View Title with Tabs -->
  <div class="layout-title">
    <span class="canvas-title-top">Canvas View</span>
  </div>

  <!-- Zoom and Undo/Redo Controls -->
  <div class="canvas-zoom-row">
    <button class="toggle-btn" onclick="zoomCanvas(-0.25)" title="Zoom Out" class="canvas-ctrl-btn-lg">−</button>
    <input type="number" id="canvasZoomInput" value="100" min="50" max="500" step="10" onchange="setCanvasZoom(this.value)" title="Enter zoom percentage">
    <button class="toggle-btn" onclick="zoomCanvas(0.25)" title="Zoom In" class="canvas-ctrl-btn-lg">+</button>
    <button class="toggle-btn" onclick="resetCanvasZoom()" title="Reset Zoom" class="canvas-ctrl-btn">Reset</button>
    <button class="toggle-btn" id="canvasUndoBtn" onclick="undoCanvasMove()" title="Undo Canvas Move" class="canvas-ctrl-btn">Undo</button>
    <button class="toggle-btn" id="canvasRedoBtn" onclick="redoCanvasMove()" title="Redo Canvas Move" class="canvas-ctrl-btn">Redo</button>
  </div>

  <div class="canvas-col-gap16">
    <!-- Canvas View -->
    <div>
      <div id="canvasViewWrapper">
        <div id="canvasViewport">
          <canvas id="canvasView"></canvas>
        </div>
      </div>
      <div class="canvas-hint-text">Pinch to zoom • Drag to pan when zoomed • Drag screens to reposition</div>
      <div class="canvas-info-text" id="canvasInfo"></div>
    </div>

    <!-- Canvas Options -->
    <div class="section-box mb-0">
      <div class="section-title">Canvas Options</div>
      <div class="section-content">
        <!-- Row 1: Canvas Size -->
        <label class="mb-8">
          <span>Canvas Size</span>
          <select id="canvasSize">
            <option value="4K_UHD" selected="">4K UHD (3840x2160)</option>
            <option value="4K_DCI">4K DCI (4096x2160)</option>
            <option value="HD">HD (1920x1080)</option>
            <option value="custom">Custom</option>
          </select>
        </label>

        <div id="customCanvasInputs" class="mb-8" style="display: none;">
          <div class="two-inputs">
            <label class="mb-0">
              <span>Width (px)</span>
              <input type="number" id="customCanvasWidth" min="1">
            </label>
            <label class="mb-0">
              <span>Height (px)</span>
              <input type="number" id="customCanvasHeight" min="1">
            </label>
          </div>
        </div>

        <!-- Row 2: X Pos, Y Pos, Snap, Fine -->
        <div class="canvas-controls-row">
          <div class="flex-1">
            <span class="toggle-label toggle-label-block">X Pos</span>
            <div class="number-input-with-arrows">
              <input type="number" id="canvasX" value="0" min="0">
              <div class="number-input-arrows">
                <button type="button" onclick="adjustCanvasPosition('canvasX', 1)">
                  <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                </button>
                <button type="button" onclick="adjustCanvasPosition('canvasX', -1)">
                  <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                </button>
              </div>
            </div>
          </div>
          <div class="flex-1">
            <span class="toggle-label toggle-label-block">Y Pos</span>
            <div class="number-input-with-arrows">
              <input type="number" id="canvasY" value="0" min="0">
              <div class="number-input-arrows">
                <button type="button" onclick="adjustCanvasPosition('canvasY', 1)">
                  <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                </button>
                <button type="button" onclick="adjustCanvasPosition('canvasY', -1)">
                  <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                </button>
              </div>
            </div>
          </div>
          <div class="snap-btn-col">
            <span class="toggle-label toggle-label-hidden">Snap</span>
            <button type="button" class="toggle-btn active" id="snapModeBtn" onclick="toggleSnapMode()">Snap</button>
          </div>
          <div class="flex-1">
            <span class="toggle-label toggle-label-block">Fine(px)</span>
            <div class="number-input-with-arrows">
              <input type="number" id="arrowKeyIncrement" value="10" min="1" max="100">
              <div class="number-input-arrows">
                <button type="button" onclick="adjustNumberInput('arrowKeyIncrement', 1)">
                  <span class="material-symbols-outlined icon-14">keyboard_arrow_up</span>
                </button>
                <button type="button" onclick="adjustNumberInput('arrowKeyIncrement', -1)">
                  <span class="material-symbols-outlined icon-14">keyboard_arrow_down</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 3: Filename -->
        <div class="mb-8">
          <input type="text" id="canvasExportFilename" placeholder="Filename...">
        </div>

        <!-- Row 4: PNG dropdown, Export button -->
        <div class="canvas-export-row">
          <select id="canvasExportFormat">
            <option value="png" selected="">PNG</option>
            <option value="jpeg">JPEG</option>
            <option value="resolume">Resolume</option>
          </select>
          <button id="btnExportCanvas" class="config-btn">Export</button>
        </div>

      </div>

      <!-- Unified Canvas Toolbar (replaces old section-content) -->
      <div class="canvas-toolbar" id="rasterCanvasToolbar">
        <div class="canvas-toolbar-group toolbar-filename">
          <span class="canvas-toolbar-label">Filename</span>
          <input type="text" id="rasterToolbarFilename" placeholder="LED_Wall_Canvas_4K_UHD_3840x2160">
        </div>
        <div class="canvas-toolbar-group toolbar-save">
          <span class="canvas-toolbar-label">&nbsp;</span>
          <button type="button" class="config-btn" onclick="saveRasterFile()">Save</button>
        </div>
        <div class="canvas-toolbar-group toolbar-load">
          <span class="canvas-toolbar-label">&nbsp;</span>
          <button type="button" class="config-btn" onclick="document.getElementById('loadRasterInput').click()">Load</button>
          <input type="file" id="loadRasterInput" accept=".blinkrast,.raster" style="display: none;" onchange="loadRasterFile(event)">
        </div>
        <div class="canvas-toolbar-group toolbar-canvas-size">
          <span class="canvas-toolbar-label">Canvas Size</span>
          <select id="rasterToolbarCanvasSize" class="min-w-140">
            <option value="4K_UHD" selected="">4K UHD (3840x2160)</option>
            <option value="4K_DCI">4K DCI (4096x2160)</option>
            <option value="HD">HD (1920x1080)</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="canvas-toolbar-group toolbar-custom-w" id="rasterCustomW" style="display: none;">
          <span class="canvas-toolbar-label">W (px)</span>
          <input type="number" id="rasterToolbarCustomW" min="1" class="w-80">
        </div>
        <div class="canvas-toolbar-group toolbar-custom-h" id="rasterCustomH" style="display: none;">
          <span class="canvas-toolbar-label">H (px)</span>
          <input type="number" id="rasterToolbarCustomH" min="1" class="w-80">
        </div>
        <div class="canvas-toolbar-group">
          <span class="canvas-toolbar-label">X Pos</span>
          <div class="number-input-with-arrows">
            <input type="number" id="rasterToolbarX" value="0" min="0">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustCanvasPosition('canvasX', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustCanvasPosition('canvasX', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
        </div>
        <div class="canvas-toolbar-group">
          <span class="canvas-toolbar-label">Y Pos</span>
          <div class="number-input-with-arrows">
            <input type="number" id="rasterToolbarY" value="0" min="0">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustCanvasPosition('canvasY', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustCanvasPosition('canvasY', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
        </div>
        <div class="canvas-toolbar-group">
          <span class="canvas-toolbar-label">Fine(px)</span>
          <div class="number-input-with-arrows">
            <input type="number" id="rasterToolbarFine" value="10" min="1" max="100">
            <div class="number-input-arrows">
              <button type="button" onclick="adjustNumberInput('arrowKeyIncrement', 1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_up</span></button>
              <button type="button" onclick="adjustNumberInput('arrowKeyIncrement', -1)"><span class="material-symbols-outlined icon-14">keyboard_arrow_down</span></button>
            </div>
          </div>
        </div>
        <div class="canvas-toolbar-group">
          <span class="canvas-toolbar-label">&nbsp;</span>
          <button type="button" class="toggle-btn active" id="rasterToolbarSnap" onclick="toggleSnapMode()">Snap</button>
        </div>
        <div class="canvas-toolbar-group toolbar-format">
          <span class="canvas-toolbar-label">Format</span>
          <select id="rasterToolbarFormat">
            <option value="png" selected="">PNG</option>
            <option value="jpeg">JPEG</option>
            <option value="resolume">Resolume</option>
          </select>
        </div>
        <div class="canvas-toolbar-group toolbar-export">
          <span class="canvas-toolbar-label">&nbsp;</span>
          <button type="button" class="config-btn" id="rasterToolbarExport" onclick="exportCanvas()">Export</button>
        </div>
      </div>

      <!-- Screen Visibility Toggles (hidden in raster mode) -->
      <div id="canvasScreenToggles"></div>
    </div>
  </div>
</div>

  <!-- Raster Screen Table (shown only in raster mode) -->
  <div id="rasterScreenTableContainer" class="layout-container raster-table-layout" style="display: none;">
    <div class="layout-title">
      <span class="canvas-title-top">Screens</span>
    </div>
    <div id="rasterScreenTable" class="raster-table-scroll">
      <!-- Dynamically generated by renderRasterScreenTable() -->
    </div>
    <button class="raster-add-btn" onclick="addRasterScreen()">+ Add Screen</button>
  </div>

  <!-- Simplified Custom Panel Modal (Raster) -->
  <div id="rasterCustomPanelModal" class="modal-overlay">
    <div class="modal-dialog modal-400">
      <div class="modal-header">
        <h2 class="modal-title">Add Custom Panel</h2>
        <button class="modal-close" onclick="closeRasterCustomPanelModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p class="raster-help-text">
          Enter pixel dimensions for raster mapping. Full panel specs can be added later in Complex mode.
        </p>
        <label class="mb-12">
          <span>Brand</span>
          <input type="text" id="rasterCpBrand" placeholder="e.g., ROE Visual">
        </label>
        <label class="mb-12">
          <span>Model Name</span>
          <input type="text" id="rasterCpModel" placeholder="e.g., Black Pearl BP2">
        </label>
        <label class="mb-12">
          <span>Pixels Wide (res_x)</span>
          <input type="number" id="rasterCpResX" placeholder="e.g., 176" min="1">
        </label>
        <label class="mb-12">
          <span>Pixels High (res_y)</span>
          <input type="number" id="rasterCpResY" placeholder="e.g., 176" min="1">
        </label>
        <button class="raster-save-panel-btn" onclick="saveRasterCustomPanel()">Save Panel</button>
      </div>
    </div>
  </div>

<!-- Supabase Client (Cloud Sync & Auth) -->
<script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.95.0/dist/umd/supabase.min.js" integrity="sha384-gmm4k/o3mzDSemzK5CComDrZ5QDvnpUGq3IXuE9luzw/ZoNhwzB2XiJzh2/JGrQV" crossorigin="anonymous"></script>

<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous"></script>

<!-- Core Utilities -->
<script defer src="core/modals.js"></script>
<script defer src="core/utils.js"></script>
<script defer src="core/update.js"></script>
<script defer src="core/supabase.js"></script>
<script defer src="core/auth-ui.js"></script>

<!-- LED Panel & Processor Specifications -->
<script defer src="specs/panels.js"></script>
<script defer src="specs/processors.js"></script>
<script defer src="specs/custom-panels.js"></script>
<script defer src="specs/custom-processors.js"></script>

<!-- Screens -->
<script defer src="screens/multi-screen.js"></script>

<!-- Core State & Undo -->
<script defer src="core/state.js"></script>
<script defer src="core/undo.js"></script>

<!-- Structure System -->
<script defer src="structure/plates.js"></script>
<script defer src="structure/bumpers.js"></script>
<script defer src="structure/weight.js"></script>
<script defer src="structure/drawing.js"></script>

<!-- Core Calculation Engine -->
<script defer src="core/calculate.js"></script>

<!-- Gear List Data (shared by gear tab, PDF export, email export) -->
<script defer src="core/gear-data.js"></script>

<!-- Layout Renderers -->
<script defer src="layouts/standard.js"></script>
<script defer src="layouts/power.js"></script>
<script defer src="layouts/data.js"></script>
<script defer src="layouts/structure.js"></script>

<!-- Canvas Interactivity -->
<script defer src="interact/standard-canvas.js"></script>

<!-- Navigation Views -->
<script defer src="nav/gear.js"></script>
<script defer src="nav/cable-diagram.js"></script>
<script defer src="nav/combined-cable-diagram.js"></script>
<script defer src="nav/canvas.js"></script>
<script defer src="nav/raster.js"></script>
<script defer src="nav/combined.js"></script>
<script defer src="nav/navigation.js"></script>
<script defer src="nav/welcome.js"></script>

<!-- Export Functions -->
<script defer src="export/canvas-export.js"></script>
<script defer src="export/resolume.js"></script>
<script defer src="export/pdf.js"></script>
<!-- Config -->
<script defer src="config/setup.js"></script>
<script defer src="config/save-load.js"></script>
<script defer src="config/gear-codes.js"></script>
<script defer src="config/dom-setup.js"></script>
<script defer src="core/init.js"></script>

<!-- Tools -->
<script defer src="https://cdn.jsdelivr.net/npm/mp4-muxer@5.1.3/build/mp4-muxer.min.js"></script>
<script defer src="tools/testpattern.js"></script>

<script>
// ==================== APP VERSION & UPDATE CHECK ====================
const APP_VERSION = '2.10.22';
const APP_CHANGELOG = 'Restructure help modal with Calculator, Raster, and Test Pattern tabs';
console.log('JavaScript loaded - v' + APP_VERSION);

// Global unit settings
let displayLengthUnit = 'ft'; // 'ft' or 'm'
let displayWeightUnit = 'lbs'; // 'lbs' or 'kg'


let lastLayoutMode = null;

// Interactive panel knockout state
let deletedPanels = new Set(); // stores "col,row" strings
let selectedPanels = new Set(); // stores "col,row" strings for multi-select
let customCircuitAssignments = new Map(); // stores "col,row" -> circuit number
let customDataLineAssignments = new Map(); // stores "col,row" -> data line number
let isDragging = false;
let dragStartX = 0;
let modalOpenedFromMenu = false; // Track if current modal came from hamburger menu
let modalReturnTo = null; // Callback to invoke when current modal closes (modal-to-modal return)
let isWelcomePageVisible = true; // Welcome page shown on initial load

// Help modal tab switching (inline to avoid SW cache issues with external JS)
function switchHelpMainTab(tab) {
  document.querySelectorAll('.help-main-tab-btn').forEach(function(btn) {
    btn.classList.toggle('active', btn.dataset.maintab === tab);
  });
  var calcTab = document.getElementById('helpCalcTab');
  var rasterTab = document.getElementById('helpRasterTab');
  var testPatternTab = document.getElementById('helpTestPatternTab');
  if(calcTab) calcTab.style.display = tab === 'calculator' ? 'block' : 'none';
  if(rasterTab) rasterTab.style.display = tab === 'raster' ? 'block' : 'none';
  if(testPatternTab) testPatternTab.style.display = tab === 'testpattern' ? 'block' : 'none';
}
function switchHelpTab(tab) {
  document.querySelectorAll('.help-tab-btn').forEach(function(btn) {
    btn.classList.toggle('active', btn.dataset.tab === tab);
  });
  var simpleContent = document.getElementById('helpSimpleContent');
  var complexContent = document.getElementById('helpComplexContent');
  if(simpleContent) simpleContent.style.display = tab === 'simple' ? 'block' : 'none';
  if(complexContent) complexContent.style.display = tab === 'complex' ? 'block' : 'none';
  var isComplex = tab === 'complex';
  document.querySelectorAll('.help-complex-section').forEach(function(el) {
    el.style.display = isComplex ? 'block' : 'none';
  });
  document.querySelectorAll('.help-simple-only').forEach(function(el) {
    el.style.display = isComplex ? 'none' : 'block';
  });
  document.querySelectorAll('.help-complex-only').forEach(function(el) {
    el.style.display = isComplex ? 'block' : 'none';
  });
}

// Eco-friendly print mode - uses lighter colors and white backgrounds
let ecoPrintMode = false;
// Greyscale print mode - converts all colors to greyscale
let greyscalePrintMode = false;

// Canvas movement undo/redo state
let canvasMoveHistory = [];
let canvasMoveHistoryIndex = -1;
const MAX_CANVAS_HISTORY = 20;

// Structure view bumper state - NEW SYSTEM
let showTopBumper = false;
let showBottomBumper = false;
let useBumpers = true; // Toggle for enabling/disabling bumpers entirely
let manualBumperMode = false; // Toggle for manual bumper distribution mode
let selectedBumpers = new Set(); // Selected bumpers (by id) in structure view
let structureIsDragging = false;
let structureDragStartX = 0;
let structureDragStartY = 0;

// Structure view undo/redo
let structureHistory = [];
let structureHistoryIndex = -1;
const MAX_STRUCTURE_HISTORY = 30;

// Legacy bumper variables (for backward compatibility during migration)
let topBumper1wColumn = -1;
let bottomBumper1wColumn = -1;
let manualTopBumpers = [];
let manualBottomBumpers = [];

// Bumper tracking system - stores all placed bumpers with their properties
let bumpers = []; // Array of {id, type:'1w'|'2w'|'4w', position:'top'|'bottom', startCol, endCol, x, y, width, height}
let nextBumperId = 1;
let selectedBumper = null; // Currently selected bumper for editing
let hoveredBumper = null; // Bumper under mouse cursor

// Structure canvas interaction state
let structureCanvas = null;
let structureDraggingBumper = null; // Currently being dragged bumper
let structureOriginalImageData = null; // Store canvas state for quick restore
let dragStartY = 0;
let currentCanvas = null;
let currentPw = 0;
let currentPh = 0;
let panelSize = 50;
let currentPanelWidth = 50;
let currentPanelHeight = 50;

// Canvas view offset (for dragging the wall around the canvas)
let canvasOffsetX = 0;
let canvasOffsetY = 0;
let canvasZoomLevel = 1.0; // Zoom level for canvas view (1.0 = 100%)
let canvasPanX = 0; // Pan offset X
let canvasPanY = 0; // Pan offset Y
let isPanningCanvas = false;
let panStartX = 0;
let panStartY = 0;

// Context menu state
let contextMenuVisible = false;
let contextMenuX = 0;
let contextMenuY = 0;
let contextMenuBumper = null;


// Undo/Redo system
let undoHistory = [];
let redoHistory = [];
const MAX_HISTORY = 50;


// Resistor colors for POWER and DATA layouts only
const resistorColors = ['#964B00','#FF0000','#FFA500','#FFFF00','#008000','#0000FF','#8B00FF','#808080','#FFFFFF','#333333'];
// Standard layout colors - magenta, cyan, yellow, blue, green, red at 50% brightness
const standardColors = [
  '#800080',  // Magenta at 50% brightness
  '#008080',  // Cyan at 50% brightness
  '#808000',  // Yellow at 50% brightness
  '#000080',  // Blue at 50% brightness
  '#008000',  // Green at 50% brightness
  '#800000'   // Red at 50% brightness
];

// ==================== END CUSTOM STORAGE SYSTEM ====================

// Bumper weights (in kg, converted from lbs where needed)
const bumperWeights = {
  '1w': 2.5,  // kg (approximate)
  '2w': 4.0,  // kg (approximate)
  '4w': 30.0  // kg (66.15 lbs)
};

// ==================== V29 MULTI-SCREEN SYSTEM (ENHANCED) ====================

// Screen management
let screens = {};
let currentScreenId = 'screen_1';
let screenIdCounter = 1;
let isLoadingScreenData = false; // Flag to prevent resetCalculator during screen loading


</script>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <!-- Complex mode groups -->
  <div class="nav-mode-toggle nav-complex-group nav-flex-2">
    <button class="nav-toggle-btn active" data-mode="complex" onclick="switchAppMode('complex')">
      <span>Complex</span>
    </button>
    <button class="nav-toggle-btn" data-mode="combined" onclick="switchAppMode('combined')">
      <span>Combined</span>
    </button>
  </div>
  <div class="nav-mode-toggle nav-complex-group nav-flex-1">
    <button class="nav-toggle-btn" data-mode="gear" onclick="switchAppMode('gear')">
      <span>Cable</span>
    </button>
  </div>
  <!-- Simple mode group (hidden by default) -->
  <div class="nav-mode-toggle nav-simple-group nav-flex-1" style="display: none;">
    <button class="nav-toggle-btn" data-mode="simple" onclick="switchAppMode('simple')">
      <span>Simple</span>
    </button>
  </div>
  <!-- Canvas (always visible) -->
  <div class="nav-mode-toggle nav-flex-1">
    <button class="nav-toggle-btn" data-view="canvas" onclick="switchMobileView('canvas')">
      <span>Canvas</span>
    </button>
  </div>
</nav>

<!-- Auth Modal -->
<div id="authModal" class="modal-overlay">
  <div class="modal-dialog auth-modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title" id="authModalTitle">Sign In</h2>
      <button class="modal-close" onclick="closeAuthModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div id="authTabs" class="auth-tabs">
        <button id="authTabSignIn" class="auth-tab active" onclick="switchAuthMode('signin')">Sign In</button>
        <button id="authTabSignUp" class="auth-tab" onclick="switchAuthMode('signup')">Sign Up</button>
      </div>
      <div id="authError" class="auth-error" style="display: none;"></div>
      <div class="modal-input-group">
        <label for="authEmail">Email</label>
        <input type="email" id="authEmail" placeholder="your@email.com" autocomplete="email">
      </div>
      <div class="modal-input-group">
        <label for="authPassword">Password</label>
        <input type="password" id="authPassword" placeholder="Password" autocomplete="current-password">
      </div>
      <div id="authPasswordConfirmGroup" class="modal-input-group" style="display: none;">
        <label for="authPasswordConfirm">Confirm Password</label>
        <input type="password" id="authPasswordConfirm" placeholder="Confirm password" autocomplete="new-password">
      </div>
      <button id="authSubmitBtn" class="btn-primary auth-submit-btn" onclick="handleAuthSubmit()">Sign In</button>
      <a id="authForgotLink" class="auth-forgot-link" onclick="switchAuthMode('reset')">Forgot password?</a>
    </div>
  </div>
</div>

<script defer src="interact/touch-gestures.js"></script>

</body>
</html>
